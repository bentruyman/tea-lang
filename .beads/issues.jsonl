{"id":"tea-1","title":"Add std.process module","description":"Introduce a `std.process` module that provides process-spawning and management primitives. Initial scope could include:\n- Running child processes with configurable stdin/stdout/stderr piping\n- Capturing process output and exit status\n- Sending signals or terminating running processes\n- Querying environment variables and current working directory\n- Cross-platform abstractions so scripts behave consistently on macOS, Linux, and Windows\nConsider ergonomic wrappers that match Tea’s async story and ensure resource cleanup is deterministic.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-23T22:38:44.685299-05:00","updated_at":"2025-10-24T13:50:39.15009-05:00","closed_at":"2025-10-24T00:41:19.053075-05:00"}
{"id":"tea-10","title":"Implement incremental sync and debounced recompiles in tea-lsp","description":"Teach the Tea language server to accept incremental `didChange` updates so editors aren't forced to resend entire buffers. Track change ranges, rebuild the in-memory document, and debounce recompilation so we avoid thrashing the compiler on every keystroke. Include a follow-up check that diagnostics still publish correctly after consecutive partial edits.","notes":"Enabled incremental textDocument/didChange handling in tea-lsp by applying range-based edits to cached buffers, clearing analysis, and debouncing recompiles before publishing diagnostics.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T01:11:57.492277-05:00","updated_at":"2025-10-24T13:50:39.148076-05:00","closed_at":"2025-10-24T01:33:25.118989-05:00"}
{"id":"tea-100","title":"Add std.http module","description":"Introduce a `std.http` module to make HTTP client interactions ergonomic. Potential features include:\n- High-level request helpers for common verbs (GET, POST, PUT, DELETE)\n- Streamed and buffered response handling with access to headers, status codes, and body\n- Support for async requests, cancellation, and timeouts\n- Configurable TLS, redirects, and cookie handling\n- Minimal server utilities (mock server, request matcher) to support testing and local development.\nStrive for an API that composes cleanly with Tea’s async primitives and error handling patterns.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T07:39:36.200058-06:00","updated_at":"2025-11-10T08:21:15.981982-06:00","closed_at":"2025-11-10T08:21:15.981982-06:00"}
{"id":"tea-101","title":"Add std.os module","description":"Add a `std.os` module that provides access to operating-system level facilities. Target capabilities might include:\n- File and directory inspection APIs (metadata, permissions, timestamps)\n- Portable path utilities and environment-specific separators\n- System information queries (platform, architecture, available memory)\n- Process-level helpers like current user/group, locale, and timezone\n- Low-level syscalls or FFI hooks surfaced through safe abstractions.\nFocus on cross-platform behavior first, documenting where functionality may vary by host OS.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T07:39:36.200486-06:00","updated_at":"2025-11-10T08:21:16.072245-06:00","closed_at":"2025-11-10T08:21:16.072245-06:00"}
{"id":"tea-102","title":"Emit compiler warnings for bad code practices","description":"Enhance the compiler to detect and report common code hygiene issues. Focus areas could include:\n- Unused imports, variables, and function arguments\n- Deprecated APIs or language constructs\n- Shadowed bindings that may hide outer scope values\n- Suspicious control flow, such as unreachable code or always-true conditions\n- Configurable warning levels and suppression annotations so advanced users can opt out selectively.\nUpdate tests and docs to establish the new linting expectations and provide guidance on resolving warnings.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T07:39:36.200817-06:00","updated_at":"2025-11-10T08:21:16.467628-06:00","closed_at":"2025-11-10T08:21:16.467628-06:00"}
{"id":"tea-103","title":"Remove VM-related benchmark infrastructure","description":"Remove --include-vm flag from scripts/bench.sh and remove VM benchmark execution code. Update benchmarks/README.md to reflect AOT-only benchmarking.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T07:39:36.201107-06:00","updated_at":"2025-11-10T08:21:16.333726-06:00","closed_at":"2025-11-10T08:21:16.333726-06:00"}
{"id":"tea-104","title":"Update documentation to reflect AOT-only compilation","description":"Update README.md, docs/explanation/aot-backend.md, and AGENTS.md to remove references to the VM backend. Clarify that Tea uses AOT compilation exclusively, similar to Rust's approach.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T07:39:36.201386-06:00","updated_at":"2025-11-10T08:21:15.890725-06:00","closed_at":"2025-11-10T08:21:15.890725-06:00"}
{"id":"tea-105","title":"Remove dead code and unused dependencies","description":"After VM removal, search for and remove any dead code, unused imports, and dependencies that were only needed for the VM backend. Run cargo clean and ensure everything still builds.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T07:39:36.201557-06:00","updated_at":"2025-11-10T08:21:16.212328-06:00","closed_at":"2025-11-10T08:21:16.212328-06:00"}
{"id":"tea-106","title":"Optimize AOT compiler to match Rust performance","description":"The Tea AOT compiler currently generates binaries that are 1.17x to 57.8x slower than equivalent Rust code. Analysis shows this is due to specific code generation issues that can be fixed:\n\n**Current Performance:**\n- loops: 111ms (57.8x slower than Rust's 1.9ms)\n- strings: 30ms (14.9x slower than Rust's 2ms)\n- math: 26ms (7.2x slower than Rust's 3.7ms)\n- dicts: 19.5ms (3.3x slower than Rust's 6ms)\n- fib: 206ms (1.17x slower than Rust's 176ms) ✅\n\n**Root Causes:**\n1. Loop variables use stack allocations (load/store) instead of SSA registers (PHI nodes)\n2. Top-level variables use global memory instead of stack/registers\n3. Primitive operations call FFI runtime instead of inline LLVM instructions\n\n**Target:** Match or exceed Rust performance on all benchmarks","design":"## Design\n\n### Phase 1: Use SSA for Immutable Variables (Target: 50x speedup on loops)\n\n**Current LLVM IR:**\n```llvm\ndefine i64 @sum_to_n(i64 %n) {\n  %i = alloca i64           ; ← Stack allocation\n  %total = alloca i64\n  store i64 0, ptr %total\n  store i64 1, ptr %i\n  \n  loop_body:\n    %total2 = load i64, ptr %total  ; ← 4 loads + 2 stores per iteration\n    %i3 = load i64, ptr %i\n    %addtmp = add i64 %total2, %i3\n    store i64 %addtmp, ptr %total\n}\n```\n\n**Target LLVM IR:**\n```llvm\ndefine i64 @sum_to_n(i64 %n) {\n  br label %loop_cond\n\nloop_cond:\n  %i.phi = phi i64 [ 1, %entry ], [ %i.next, %loop_body ]\n  %total.phi = phi i64 [ 0, %entry ], [ %total.next, %loop_body ]\n  ; ... no memory operations!\n\nloop_body:\n  %total.next = add i64 %total.phi, %i.phi    ; ← Pure register ops\n  %i.next = add i64 %i.phi, 1\n}\n```\n\n**Implementation:**\n\n1. Modify `LocalVariable` usage to distinguish mutable vs immutable:\n   - Immutable: Store `value` (SSA), leave `pointer` as None\n   - Mutable: Store `pointer`, leave `value` as None\n\n2. In `compile_var_statement`:\n   - Check `var_stmt.is_const` or use `find_mutated_in_statements`\n   - For immutable: Store SSA value directly\n   - For mutable: Allocate stack space\n\n3. In `compile_loop_statement`:\n   - Use PHI nodes for loop variables\n   - Track SSA values across loop iterations\n\n4. In `compile_identifier_expression`:\n   - For immutable vars: Return SSA value directly\n   - For mutable vars: Load from pointer\n\n### Phase 2: Move Globals to Stack\n\n1. In `compile_main`:\n   - Allocate stack space for top-level vars\n   - Pass as arguments to functions if needed\n   - Or use SSA for const globals\n\n### Phase 3: Inline Primitive Operations\n\n1. String concatenation: Detect small constant strings, fold at compile-time\n2. Arithmetic: Already inlined, ensure no unnecessary boxing\n3. Collection operations: Inline len(), get() for small fixed-size collections\n\n**Code Locations:**\n- `tea-compiler/src/aot/mod.rs:480-490` (LocalVariable struct)\n- `tea-compiler/src/aot/mod.rs:1462-1520` (Loop compilation)\n- `tea-compiler/src/aot/mod.rs:1787-1810` (Global variables)\n- `tea-compiler/src/aot/mod.rs:1152-1237` (Function parameters)","acceptance_criteria":"## Acceptance Criteria\n\n### Phase 1: SSA for Immutable Variables\n- [ ] Immutable local variables use SSA values (no alloca/load/store)\n- [ ] Loop variables use PHI nodes\n- [ ] Function parameters that aren't mutated use SSA\n- [ ] Loops benchmark: \u003c 5ms (down from 111ms, target: ~2ms to match Rust)\n- [ ] All tests pass\n\n### Phase 2: Stack Locals\n- [ ] Top-level variables allocated on stack in main\n- [ ] No global variables for mutable bindings\n- [ ] All benchmarks improve by 2-3x\n\n### Phase 3: Inline Primitives\n- [ ] Arithmetic operations fully inlined (no FFI)\n- [ ] Small string operations optimized\n- [ ] Math benchmark: \u003c 5ms (down from 26ms)\n- [ ] Strings benchmark: \u003c 5ms (down from 30ms)\n\n### Overall Success\n- [ ] All benchmarks within 2x of Rust (minimum)\n- [ ] At least 3 benchmarks match or beat Rust (target)\n- [ ] No performance regression on fib benchmark\n- [ ] Generated LLVM IR shows PHI nodes in loops\n- [ ] Generated LLVM IR shows no unnecessary memory operations","status":"closed","priority":1,"issue_type":"task","assignee":"assistant","created_at":"2025-11-10T07:39:36.201737-06:00","updated_at":"2025-11-10T08:21:15.801608-06:00","closed_at":"2025-11-10T08:21:15.801608-06:00"}
{"id":"tea-107","title":"Add std.http module","description":"Introduce a `std.http` module to make HTTP client interactions ergonomic. Potential features include:\n- High-level request helpers for common verbs (GET, POST, PUT, DELETE)\n- Streamed and buffered response handling with access to headers, status codes, and body\n- Support for async requests, cancellation, and timeouts\n- Configurable TLS, redirects, and cookie handling\n- Minimal server utilities (mock server, request matcher) to support testing and local development.\nStrive for an API that composes cleanly with Tea’s async primitives and error handling patterns.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:00:44.075004-06:00","updated_at":"2025-11-10T08:21:16.000233-06:00","closed_at":"2025-11-10T08:21:16.000233-06:00"}
{"id":"tea-108","title":"Add std.os module","description":"Add a `std.os` module that provides access to operating-system level facilities. Target capabilities might include:\n- File and directory inspection APIs (metadata, permissions, timestamps)\n- Portable path utilities and environment-specific separators\n- System information queries (platform, architecture, available memory)\n- Process-level helpers like current user/group, locale, and timezone\n- Low-level syscalls or FFI hooks surfaced through safe abstractions.\nFocus on cross-platform behavior first, documenting where functionality may vary by host OS.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:00:44.075287-06:00","updated_at":"2025-11-10T08:21:16.089653-06:00","closed_at":"2025-11-10T08:21:16.089653-06:00"}
{"id":"tea-109","title":"Emit compiler warnings for bad code practices","description":"Enhance the compiler to detect and report common code hygiene issues. Focus areas could include:\n- Unused imports, variables, and function arguments\n- Deprecated APIs or language constructs\n- Shadowed bindings that may hide outer scope values\n- Suspicious control flow, such as unreachable code or always-true conditions\n- Configurable warning levels and suppression annotations so advanced users can opt out selectively.\nUpdate tests and docs to establish the new linting expectations and provide guidance on resolving warnings.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:00:44.075527-06:00","updated_at":"2025-11-10T08:21:16.486249-06:00","closed_at":"2025-11-10T08:21:16.486249-06:00"}
{"id":"tea-11","title":"Add hover, completion, and go-to-definition to tea-lsp","description":"Extend the LSP so it surfaces semantic information from `tea-compiler`. Wire up resolver/type data to power hover tooltips, identifier completion, and go-to-definition. Ensure we only respond when the compiler can resolve symbols to avoid misleading empty results, and add regression coverage with fixture files where possible.","notes":"Implemented hover, completion, and go-to-definition handlers in tea-lsp using compiler AST symbol collection. Language server now advertises capabilities and returns document symbols for editor features.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T01:12:01.239624-05:00","updated_at":"2025-10-24T13:50:39.147746-05:00","closed_at":"2025-10-24T01:22:49.991577-05:00"}
{"id":"tea-110","title":"Remove VM-related benchmark infrastructure","description":"Remove --include-vm flag from scripts/bench.sh and remove VM benchmark execution code. Update benchmarks/README.md to reflect AOT-only benchmarking.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:00:44.075742-06:00","updated_at":"2025-11-10T08:21:16.350688-06:00","closed_at":"2025-11-10T08:21:16.350688-06:00"}
{"id":"tea-111","title":"Update documentation to reflect AOT-only compilation","description":"Update README.md, docs/explanation/aot-backend.md, and AGENTS.md to remove references to the VM backend. Clarify that Tea uses AOT compilation exclusively, similar to Rust's approach.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:00:44.075996-06:00","updated_at":"2025-11-10T08:21:15.90942-06:00","closed_at":"2025-11-10T08:21:15.90942-06:00"}
{"id":"tea-112","title":"Remove dead code and unused dependencies","description":"After VM removal, search for and remove any dead code, unused imports, and dependencies that were only needed for the VM backend. Run cargo clean and ensure everything still builds.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:00:44.076254-06:00","updated_at":"2025-11-10T08:21:16.230265-06:00","closed_at":"2025-11-10T08:21:16.230265-06:00"}
{"id":"tea-113","title":"Optimize AOT compiler to match Rust performance","description":"The Tea AOT compiler currently generates binaries that are 1.17x to 57.8x slower than equivalent Rust code. Analysis shows this is due to specific code generation issues that can be fixed:\n\n**Current Performance:**\n- loops: 111ms (57.8x slower than Rust's 1.9ms)\n- strings: 30ms (14.9x slower than Rust's 2ms)\n- math: 26ms (7.2x slower than Rust's 3.7ms)\n- dicts: 19.5ms (3.3x slower than Rust's 6ms)\n- fib: 206ms (1.17x slower than Rust's 176ms) ✅\n\n**Root Causes:**\n1. Loop variables use stack allocations (load/store) instead of SSA registers (PHI nodes)\n2. Top-level variables use global memory instead of stack/registers\n3. Primitive operations call FFI runtime instead of inline LLVM instructions\n\n**Target:** Match or exceed Rust performance on all benchmarks","design":"## Design\n\n### Phase 1: Use SSA for Immutable Variables (Target: 50x speedup on loops)\n\n**Current LLVM IR:**\n```llvm\ndefine i64 @sum_to_n(i64 %n) {\n  %i = alloca i64           ; ← Stack allocation\n  %total = alloca i64\n  store i64 0, ptr %total\n  store i64 1, ptr %i\n  \n  loop_body:\n    %total2 = load i64, ptr %total  ; ← 4 loads + 2 stores per iteration\n    %i3 = load i64, ptr %i\n    %addtmp = add i64 %total2, %i3\n    store i64 %addtmp, ptr %total\n}\n```\n\n**Target LLVM IR:**\n```llvm\ndefine i64 @sum_to_n(i64 %n) {\n  br label %loop_cond\n\nloop_cond:\n  %i.phi = phi i64 [ 1, %entry ], [ %i.next, %loop_body ]\n  %total.phi = phi i64 [ 0, %entry ], [ %total.next, %loop_body ]\n  ; ... no memory operations!\n\nloop_body:\n  %total.next = add i64 %total.phi, %i.phi    ; ← Pure register ops\n  %i.next = add i64 %i.phi, 1\n}\n```\n\n**Implementation:**\n\n1. Modify `LocalVariable` usage to distinguish mutable vs immutable:\n   - Immutable: Store `value` (SSA), leave `pointer` as None\n   - Mutable: Store `pointer`, leave `value` as None\n\n2. In `compile_var_statement`:\n   - Check `var_stmt.is_const` or use `find_mutated_in_statements`\n   - For immutable: Store SSA value directly\n   - For mutable: Allocate stack space\n\n3. In `compile_loop_statement`:\n   - Use PHI nodes for loop variables\n   - Track SSA values across loop iterations\n\n4. In `compile_identifier_expression`:\n   - For immutable vars: Return SSA value directly\n   - For mutable vars: Load from pointer\n\n### Phase 2: Move Globals to Stack\n\n1. In `compile_main`:\n   - Allocate stack space for top-level vars\n   - Pass as arguments to functions if needed\n   - Or use SSA for const globals\n\n### Phase 3: Inline Primitive Operations\n\n1. String concatenation: Detect small constant strings, fold at compile-time\n2. Arithmetic: Already inlined, ensure no unnecessary boxing\n3. Collection operations: Inline len(), get() for small fixed-size collections\n\n**Code Locations:**\n- `tea-compiler/src/aot/mod.rs:480-490` (LocalVariable struct)\n- `tea-compiler/src/aot/mod.rs:1462-1520` (Loop compilation)\n- `tea-compiler/src/aot/mod.rs:1787-1810` (Global variables)\n- `tea-compiler/src/aot/mod.rs:1152-1237` (Function parameters)","acceptance_criteria":"## Acceptance Criteria\n\n### Phase 1: SSA for Immutable Variables\n- [ ] Immutable local variables use SSA values (no alloca/load/store)\n- [ ] Loop variables use PHI nodes\n- [ ] Function parameters that aren't mutated use SSA\n- [ ] Loops benchmark: \u003c 5ms (down from 111ms, target: ~2ms to match Rust)\n- [ ] All tests pass\n\n### Phase 2: Stack Locals\n- [ ] Top-level variables allocated on stack in main\n- [ ] No global variables for mutable bindings\n- [ ] All benchmarks improve by 2-3x\n\n### Phase 3: Inline Primitives\n- [ ] Arithmetic operations fully inlined (no FFI)\n- [ ] Small string operations optimized\n- [ ] Math benchmark: \u003c 5ms (down from 26ms)\n- [ ] Strings benchmark: \u003c 5ms (down from 30ms)\n\n### Overall Success\n- [ ] All benchmarks within 2x of Rust (minimum)\n- [ ] At least 3 benchmarks match or beat Rust (target)\n- [ ] No performance regression on fib benchmark\n- [ ] Generated LLVM IR shows PHI nodes in loops\n- [ ] Generated LLVM IR shows no unnecessary memory operations","status":"closed","priority":1,"issue_type":"task","assignee":"assistant","created_at":"2025-11-10T08:00:44.0765-06:00","updated_at":"2025-11-10T08:21:15.81824-06:00","closed_at":"2025-11-10T08:21:15.81824-06:00"}
{"id":"tea-114","title":"Add std.http module","description":"Introduce a `std.http` module to make HTTP client interactions ergonomic. Potential features include:\n- High-level request helpers for common verbs (GET, POST, PUT, DELETE)\n- Streamed and buffered response handling with access to headers, status codes, and body\n- Support for async requests, cancellation, and timeouts\n- Configurable TLS, redirects, and cookie handling\n- Minimal server utilities (mock server, request matcher) to support testing and local development.\nStrive for an API that composes cleanly with Tea’s async primitives and error handling patterns.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:02:10.562074-06:00","updated_at":"2025-11-10T08:21:16.017454-06:00","closed_at":"2025-11-10T08:21:16.017454-06:00"}
{"id":"tea-115","title":"Add std.os module","description":"Add a `std.os` module that provides access to operating-system level facilities. Target capabilities might include:\n- File and directory inspection APIs (metadata, permissions, timestamps)\n- Portable path utilities and environment-specific separators\n- System information queries (platform, architecture, available memory)\n- Process-level helpers like current user/group, locale, and timezone\n- Low-level syscalls or FFI hooks surfaced through safe abstractions.\nFocus on cross-platform behavior first, documenting where functionality may vary by host OS.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:02:10.562389-06:00","updated_at":"2025-11-10T08:21:16.10748-06:00","closed_at":"2025-11-10T08:21:16.10748-06:00"}
{"id":"tea-116","title":"Emit compiler warnings for bad code practices","description":"Enhance the compiler to detect and report common code hygiene issues. Focus areas could include:\n- Unused imports, variables, and function arguments\n- Deprecated APIs or language constructs\n- Shadowed bindings that may hide outer scope values\n- Suspicious control flow, such as unreachable code or always-true conditions\n- Configurable warning levels and suppression annotations so advanced users can opt out selectively.\nUpdate tests and docs to establish the new linting expectations and provide guidance on resolving warnings.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:02:10.562638-06:00","updated_at":"2025-11-10T08:21:16.506001-06:00","closed_at":"2025-11-10T08:21:16.506001-06:00"}
{"id":"tea-117","title":"Remove VM-related benchmark infrastructure","description":"Remove --include-vm flag from scripts/bench.sh and remove VM benchmark execution code. Update benchmarks/README.md to reflect AOT-only benchmarking.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:02:10.562851-06:00","updated_at":"2025-11-10T08:21:16.370655-06:00","closed_at":"2025-11-10T08:21:16.370655-06:00"}
{"id":"tea-118","title":"Update documentation to reflect AOT-only compilation","description":"Update README.md, docs/explanation/aot-backend.md, and AGENTS.md to remove references to the VM backend. Clarify that Tea uses AOT compilation exclusively, similar to Rust's approach.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:02:10.563015-06:00","updated_at":"2025-11-10T08:21:15.927693-06:00","closed_at":"2025-11-10T08:21:15.927693-06:00"}
{"id":"tea-119","title":"Remove dead code and unused dependencies","description":"After VM removal, search for and remove any dead code, unused imports, and dependencies that were only needed for the VM backend. Run cargo clean and ensure everything still builds.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:02:10.563174-06:00","updated_at":"2025-11-10T08:21:16.247527-06:00","closed_at":"2025-11-10T08:21:16.247527-06:00"}
{"id":"tea-12","title":"Run tea-lsp diagnostics off-thread with cancellation support","description":"Move compilation work in the language server onto spawned tasks so the main request loop stays responsive. Add cancellation handling via LSP `textDocument/didChange` and `$/cancelRequest` so in-flight compiles can be dropped when superseded. Confirm diagnostics are only published from the latest completed compile.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T01:12:04.913782-05:00","updated_at":"2025-10-24T13:50:39.147353-05:00","closed_at":"2025-10-24T12:46:23.753456-05:00"}
{"id":"tea-120","title":"Optimize AOT compiler to match Rust performance","description":"The Tea AOT compiler currently generates binaries that are 1.17x to 57.8x slower than equivalent Rust code. Analysis shows this is due to specific code generation issues that can be fixed:\n\n**Current Performance:**\n- loops: 111ms (57.8x slower than Rust's 1.9ms)\n- strings: 30ms (14.9x slower than Rust's 2ms)\n- math: 26ms (7.2x slower than Rust's 3.7ms)\n- dicts: 19.5ms (3.3x slower than Rust's 6ms)\n- fib: 206ms (1.17x slower than Rust's 176ms) ✅\n\n**Root Causes:**\n1. Loop variables use stack allocations (load/store) instead of SSA registers (PHI nodes)\n2. Top-level variables use global memory instead of stack/registers\n3. Primitive operations call FFI runtime instead of inline LLVM instructions\n\n**Target:** Match or exceed Rust performance on all benchmarks","design":"## Design\n\n### Phase 1: Use SSA for Immutable Variables (Target: 50x speedup on loops)\n\n**Current LLVM IR:**\n```llvm\ndefine i64 @sum_to_n(i64 %n) {\n  %i = alloca i64           ; ← Stack allocation\n  %total = alloca i64\n  store i64 0, ptr %total\n  store i64 1, ptr %i\n  \n  loop_body:\n    %total2 = load i64, ptr %total  ; ← 4 loads + 2 stores per iteration\n    %i3 = load i64, ptr %i\n    %addtmp = add i64 %total2, %i3\n    store i64 %addtmp, ptr %total\n}\n```\n\n**Target LLVM IR:**\n```llvm\ndefine i64 @sum_to_n(i64 %n) {\n  br label %loop_cond\n\nloop_cond:\n  %i.phi = phi i64 [ 1, %entry ], [ %i.next, %loop_body ]\n  %total.phi = phi i64 [ 0, %entry ], [ %total.next, %loop_body ]\n  ; ... no memory operations!\n\nloop_body:\n  %total.next = add i64 %total.phi, %i.phi    ; ← Pure register ops\n  %i.next = add i64 %i.phi, 1\n}\n```\n\n**Implementation:**\n\n1. Modify `LocalVariable` usage to distinguish mutable vs immutable:\n   - Immutable: Store `value` (SSA), leave `pointer` as None\n   - Mutable: Store `pointer`, leave `value` as None\n\n2. In `compile_var_statement`:\n   - Check `var_stmt.is_const` or use `find_mutated_in_statements`\n   - For immutable: Store SSA value directly\n   - For mutable: Allocate stack space\n\n3. In `compile_loop_statement`:\n   - Use PHI nodes for loop variables\n   - Track SSA values across loop iterations\n\n4. In `compile_identifier_expression`:\n   - For immutable vars: Return SSA value directly\n   - For mutable vars: Load from pointer\n\n### Phase 2: Move Globals to Stack\n\n1. In `compile_main`:\n   - Allocate stack space for top-level vars\n   - Pass as arguments to functions if needed\n   - Or use SSA for const globals\n\n### Phase 3: Inline Primitive Operations\n\n1. String concatenation: Detect small constant strings, fold at compile-time\n2. Arithmetic: Already inlined, ensure no unnecessary boxing\n3. Collection operations: Inline len(), get() for small fixed-size collections\n\n**Code Locations:**\n- `tea-compiler/src/aot/mod.rs:480-490` (LocalVariable struct)\n- `tea-compiler/src/aot/mod.rs:1462-1520` (Loop compilation)\n- `tea-compiler/src/aot/mod.rs:1787-1810` (Global variables)\n- `tea-compiler/src/aot/mod.rs:1152-1237` (Function parameters)","acceptance_criteria":"## Acceptance Criteria\n\n### Phase 1: SSA for Immutable Variables\n- [ ] Immutable local variables use SSA values (no alloca/load/store)\n- [ ] Loop variables use PHI nodes\n- [ ] Function parameters that aren't mutated use SSA\n- [ ] Loops benchmark: \u003c 5ms (down from 111ms, target: ~2ms to match Rust)\n- [ ] All tests pass\n\n### Phase 2: Stack Locals\n- [ ] Top-level variables allocated on stack in main\n- [ ] No global variables for mutable bindings\n- [ ] All benchmarks improve by 2-3x\n\n### Phase 3: Inline Primitives\n- [ ] Arithmetic operations fully inlined (no FFI)\n- [ ] Small string operations optimized\n- [ ] Math benchmark: \u003c 5ms (down from 26ms)\n- [ ] Strings benchmark: \u003c 5ms (down from 30ms)\n\n### Overall Success\n- [ ] All benchmarks within 2x of Rust (minimum)\n- [ ] At least 3 benchmarks match or beat Rust (target)\n- [ ] No performance regression on fib benchmark\n- [ ] Generated LLVM IR shows PHI nodes in loops\n- [ ] Generated LLVM IR shows no unnecessary memory operations","status":"closed","priority":1,"issue_type":"task","assignee":"assistant","created_at":"2025-11-10T08:02:10.563344-06:00","updated_at":"2025-11-10T08:21:15.836219-06:00","closed_at":"2025-11-10T08:21:15.836219-06:00"}
{"id":"tea-121","title":"Add std.http module","description":"Introduce a `std.http` module to make HTTP client interactions ergonomic. Potential features include:\n- High-level request helpers for common verbs (GET, POST, PUT, DELETE)\n- Streamed and buffered response handling with access to headers, status codes, and body\n- Support for async requests, cancellation, and timeouts\n- Configurable TLS, redirects, and cookie handling\n- Minimal server utilities (mock server, request matcher) to support testing and local development.\nStrive for an API that composes cleanly with Tea’s async primitives and error handling patterns.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:03:24.026901-06:00","updated_at":"2025-11-10T08:21:16.03678-06:00","closed_at":"2025-11-10T08:21:16.03678-06:00"}
{"id":"tea-122","title":"Add std.os module","description":"Add a `std.os` module that provides access to operating-system level facilities. Target capabilities might include:\n- File and directory inspection APIs (metadata, permissions, timestamps)\n- Portable path utilities and environment-specific separators\n- System information queries (platform, architecture, available memory)\n- Process-level helpers like current user/group, locale, and timezone\n- Low-level syscalls or FFI hooks surfaced through safe abstractions.\nFocus on cross-platform behavior first, documenting where functionality may vary by host OS.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:03:24.027158-06:00","updated_at":"2025-11-10T08:21:16.124496-06:00","closed_at":"2025-11-10T08:21:16.124496-06:00"}
{"id":"tea-123","title":"Emit compiler warnings for bad code practices","description":"Enhance the compiler to detect and report common code hygiene issues. Focus areas could include:\n- Unused imports, variables, and function arguments\n- Deprecated APIs or language constructs\n- Shadowed bindings that may hide outer scope values\n- Suspicious control flow, such as unreachable code or always-true conditions\n- Configurable warning levels and suppression annotations so advanced users can opt out selectively.\nUpdate tests and docs to establish the new linting expectations and provide guidance on resolving warnings.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:03:24.027346-06:00","updated_at":"2025-11-10T08:21:16.524122-06:00","closed_at":"2025-11-10T08:21:16.524122-06:00"}
{"id":"tea-124","title":"Remove VM-related benchmark infrastructure","description":"Remove --include-vm flag from scripts/bench.sh and remove VM benchmark execution code. Update benchmarks/README.md to reflect AOT-only benchmarking.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:03:24.027589-06:00","updated_at":"2025-11-10T08:21:16.389424-06:00","closed_at":"2025-11-10T08:21:16.389424-06:00"}
{"id":"tea-125","title":"Update documentation to reflect AOT-only compilation","description":"Update README.md, docs/explanation/aot-backend.md, and AGENTS.md to remove references to the VM backend. Clarify that Tea uses AOT compilation exclusively, similar to Rust's approach.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:03:24.027768-06:00","updated_at":"2025-11-10T08:21:15.946529-06:00","closed_at":"2025-11-10T08:21:15.946529-06:00"}
{"id":"tea-126","title":"Remove dead code and unused dependencies","description":"After VM removal, search for and remove any dead code, unused imports, and dependencies that were only needed for the VM backend. Run cargo clean and ensure everything still builds.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T08:03:24.027957-06:00","updated_at":"2025-11-10T08:21:16.264914-06:00","closed_at":"2025-11-10T08:21:16.264914-06:00"}
{"id":"tea-127","title":"Optimize AOT compiler to match Rust performance","description":"The Tea AOT compiler currently generates binaries that are 1.17x to 57.8x slower than equivalent Rust code. Analysis shows this is due to specific code generation issues that can be fixed:\n\n**Current Performance:**\n- loops: 111ms (57.8x slower than Rust's 1.9ms)\n- strings: 30ms (14.9x slower than Rust's 2ms)\n- math: 26ms (7.2x slower than Rust's 3.7ms)\n- dicts: 19.5ms (3.3x slower than Rust's 6ms)\n- fib: 206ms (1.17x slower than Rust's 176ms) ✅\n\n**Root Causes:**\n1. Loop variables use stack allocations (load/store) instead of SSA registers (PHI nodes)\n2. Top-level variables use global memory instead of stack/registers\n3. Primitive operations call FFI runtime instead of inline LLVM instructions\n\n**Target:** Match or exceed Rust performance on all benchmarks","design":"## Design\n\n### Phase 1: Use SSA for Immutable Variables (Target: 50x speedup on loops)\n\n**Current LLVM IR:**\n```llvm\ndefine i64 @sum_to_n(i64 %n) {\n  %i = alloca i64           ; ← Stack allocation\n  %total = alloca i64\n  store i64 0, ptr %total\n  store i64 1, ptr %i\n  \n  loop_body:\n    %total2 = load i64, ptr %total  ; ← 4 loads + 2 stores per iteration\n    %i3 = load i64, ptr %i\n    %addtmp = add i64 %total2, %i3\n    store i64 %addtmp, ptr %total\n}\n```\n\n**Target LLVM IR:**\n```llvm\ndefine i64 @sum_to_n(i64 %n) {\n  br label %loop_cond\n\nloop_cond:\n  %i.phi = phi i64 [ 1, %entry ], [ %i.next, %loop_body ]\n  %total.phi = phi i64 [ 0, %entry ], [ %total.next, %loop_body ]\n  ; ... no memory operations!\n\nloop_body:\n  %total.next = add i64 %total.phi, %i.phi    ; ← Pure register ops\n  %i.next = add i64 %i.phi, 1\n}\n```\n\n**Implementation:**\n\n1. Modify `LocalVariable` usage to distinguish mutable vs immutable:\n   - Immutable: Store `value` (SSA), leave `pointer` as None\n   - Mutable: Store `pointer`, leave `value` as None\n\n2. In `compile_var_statement`:\n   - Check `var_stmt.is_const` or use `find_mutated_in_statements`\n   - For immutable: Store SSA value directly\n   - For mutable: Allocate stack space\n\n3. In `compile_loop_statement`:\n   - Use PHI nodes for loop variables\n   - Track SSA values across loop iterations\n\n4. In `compile_identifier_expression`:\n   - For immutable vars: Return SSA value directly\n   - For mutable vars: Load from pointer\n\n### Phase 2: Move Globals to Stack\n\n1. In `compile_main`:\n   - Allocate stack space for top-level vars\n   - Pass as arguments to functions if needed\n   - Or use SSA for const globals\n\n### Phase 3: Inline Primitive Operations\n\n1. String concatenation: Detect small constant strings, fold at compile-time\n2. Arithmetic: Already inlined, ensure no unnecessary boxing\n3. Collection operations: Inline len(), get() for small fixed-size collections\n\n**Code Locations:**\n- `tea-compiler/src/aot/mod.rs:480-490` (LocalVariable struct)\n- `tea-compiler/src/aot/mod.rs:1462-1520` (Loop compilation)\n- `tea-compiler/src/aot/mod.rs:1787-1810` (Global variables)\n- `tea-compiler/src/aot/mod.rs:1152-1237` (Function parameters)","acceptance_criteria":"## Acceptance Criteria\n\n### Phase 1: SSA for Immutable Variables\n- [ ] Immutable local variables use SSA values (no alloca/load/store)\n- [ ] Loop variables use PHI nodes\n- [ ] Function parameters that aren't mutated use SSA\n- [ ] Loops benchmark: \u003c 5ms (down from 111ms, target: ~2ms to match Rust)\n- [ ] All tests pass\n\n### Phase 2: Stack Locals\n- [ ] Top-level variables allocated on stack in main\n- [ ] No global variables for mutable bindings\n- [ ] All benchmarks improve by 2-3x\n\n### Phase 3: Inline Primitives\n- [ ] Arithmetic operations fully inlined (no FFI)\n- [ ] Small string operations optimized\n- [ ] Math benchmark: \u003c 5ms (down from 26ms)\n- [ ] Strings benchmark: \u003c 5ms (down from 30ms)\n\n### Overall Success\n- [ ] All benchmarks within 2x of Rust (minimum)\n- [ ] At least 3 benchmarks match or beat Rust (target)\n- [ ] No performance regression on fib benchmark\n- [ ] Generated LLVM IR shows PHI nodes in loops\n- [ ] Generated LLVM IR shows no unnecessary memory operations","status":"closed","priority":1,"issue_type":"task","assignee":"assistant","created_at":"2025-11-10T08:03:24.02813-06:00","updated_at":"2025-11-10T08:21:15.85347-06:00","closed_at":"2025-11-10T08:21:15.85347-06:00"}
{"id":"tea-128","title":"Improve installation experience for beta release","description":"Make it easy for users to install Tea without needing to understand the build system details.\n\nCurrent state:\n- Users must clone repo, run make setup, make build, make install\n- Requires understanding of Rust, Cargo, and Bun\n- No automated installer script\n- No prebuilt binaries\n\nIssues to address:\n- Installation requires multiple manual steps\n- Prerequisites (Rust, Bun, LLVM) not clearly documented\n- No simple one-command installation option","design":"Create an install.sh script that:\n1. Detects the platform (macOS, Linux)\n2. Checks for required dependencies (Rust/Cargo, Bun)\n3. Prompts to install missing dependencies or provides instructions\n4. Clones/downloads the repo if needed\n5. Runs the build process (make setup \u0026\u0026 make build)\n6. Installs binaries to ~/.cargo/bin or /usr/local/bin\n7. Verifies installation with tea --version\n8. Provides next steps for the user\n\nAlso update README.md with:\n- Clear prerequisites section\n- One-line installation command: curl -fsSL https://tea-lang.sh/install.sh | sh\n- Alternative manual installation steps\n- Troubleshooting section for common issues","acceptance_criteria":"- install.sh script works on macOS and common Linux distros\n- Script detects and reports missing dependencies\n- Script successfully builds and installs tea and tea-lsp\n- README.md has clear installation instructions\n- Installation can be completed with one command for users with prerequisites\n- Script provides helpful error messages if something fails","notes":"Domain setup plan created in DOMAINS.md\n\nNext steps:\n1. Set up GitHub Pages for tea-lang.dev (quickest path to production)\n2. Configure DNS CNAME: tea-lang.dev → bentruyman.github.io\n3. Create gh-pages branch with install.sh\n4. Enable custom domain in GitHub Pages settings\n5. Test: curl -fsSL https://tea-lang.dev/install.sh | bash\n\nAlternative domains available:\n- tea-lang.com (for marketing/landing page)\n- tea-lang.dev (for technical content, installation, docs)\n\nCurrent status:\n- install.sh created and tested ✓\n- README updated with tea-lang.dev URL ✓\n- Domain setup guide created ✓\n- Waiting for DNS/hosting configuration","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-11T08:58:59.068112-06:00","updated_at":"2025-12-03T19:38:35.216158-06:00","closed_at":"2025-12-03T19:38:35.216158-06:00"}
{"id":"tea-13","title":"Provide workspace-aware diagnostics in tea-lsp","description":"Enhance the server to track open modules and their dependencies so edits in one file can surface diagnostics in others. Consider file watchers or import graph traversal to keep module state fresh, and emit workspace-wide diagnostics where supported by the LSP. Document any limitations around project layout or stdlib resolution.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T01:12:08.419224-05:00","updated_at":"2025-10-24T13:50:39.147072-05:00","closed_at":"2025-10-24T12:43:38.154024-05:00"}
{"id":"tea-14","title":"Expose tea-lsp configuration and settings sync","description":"Support `workspace/didChangeConfiguration` so users can tweak language server behavior (e.g., backend selection, stdlib search paths, diagnostics toggles). Reflect configuration in the server capabilities, plumb settings into compile options, and persist sensible defaults when the client lacks settings support.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-10-24T01:12:11.696276-05:00","updated_at":"2025-10-24T19:51:37.25301-05:00","closed_at":"2025-10-24T19:51:37.25301-05:00"}
{"id":"tea-15","title":"Document Tea LSP installation and editor setup","description":"Write docs explaining how to install and run the `tea-lsp` binary, hook it up to common editors (Neovim, VS Code), and troubleshoot typical issues. Surface the guide in `docs/` and link from the README so contributors can discover it easily.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-10-24T01:12:15.787957-05:00","updated_at":"2025-10-24T16:24:34.512646-05:00","closed_at":"2025-10-24T16:24:34.512646-05:00"}
{"id":"tea-16","title":"Improve tea-lsp logging and progress reporting","description":"Tighten language-server observability with structured logs and progress notifications. Emit scoped info when compiles start/finish, optionally surface `window/workDoneProgress` updates for long-running diagnostics, and ensure failures always include enough context for debugging.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-10-24T01:12:20.977404-05:00","updated_at":"2025-10-24T13:50:39.150704-05:00","closed_at":"2025-10-24T13:39:50.051258-05:00"}
{"id":"tea-17","title":"Support docstrings in tea-lsp hovers","description":"Teach the language server to surface inline documentation for functions, structs, and fields. Decide on a docstring format (e.g., leading comments or specially marked blocks), parse the docs during compilation, and include them in hover responses so editors show rich descriptions alongside signatures.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-10-24T02:41:11.218367-05:00","updated_at":"2025-10-24T13:50:39.1505-05:00","closed_at":"2025-10-24T13:37:00.986625-05:00"}
{"id":"tea-18","title":"Provide type-aware completions in tea-lsp","description":"Teach tea-lsp to use compiler type information when producing completion items. Expose in-scope bindings and expected argument types from the compiler/typechecker, and filter completion candidates so editors see only symbols compatible with the position (e.g., strings when a string argument is expected).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T02:46:27.893202-05:00","updated_at":"2025-10-24T13:50:39.146752-05:00","closed_at":"2025-10-24T12:29:35.394408-05:00"}
{"id":"tea-19","title":"Propagate parser/resolver errors as diagnostics","description":"Ensure tea-lsp receives structured diagnostics for parser and resolver failures instead of only an error message. Update the compiler so parse and name-resolution errors always push Diagnostics entries with accurate spans before returning Err, eliminating the \"no diagnostics emitted\" fallback.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T02:58:21.58701-05:00","updated_at":"2025-10-24T13:50:39.146329-05:00","closed_at":"2025-10-24T12:36:07.822589-05:00"}
{"id":"tea-20","title":"Disallow newline-separated closing bracket in struct generics","description":"Tighten the parser so type parameter lists for structs/functions must close with `]` on the same line as the name, rejecting layouts like `struct Box[T` newline `]`. Ensure we emit a clear diagnostic pointing to the stray closing bracket.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-10-24T08:56:49.855138-05:00","updated_at":"2025-10-24T19:51:37.252205-05:00","closed_at":"2025-10-24T19:51:37.252205-05:00"}
{"id":"tea-21","title":"Add docstring support to Tea stdlib","description":"Add descriptive docstrings for Tea's standard library functions and surface them through the compiler/LSP so hover information is available even though the stdlib is not authored in Tea source files. Investigate how to represent, store, and expose doc comments for generated or built-in bindings.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T14:05:55.497469-05:00","updated_at":"2025-10-24T16:05:02.93588-05:00","closed_at":"2025-10-24T16:05:02.93588-05:00"}
{"id":"tea-22","title":"feat: introduce match pattern matching syntax","description":"Add a `match` expression that can branch on both value comparisons and type discriminants. Initial syntax should support matching against literals, identifiers, and wildcards, allowing multi-pattern unions per case (e.g. `case \"y\" | \"yes\"`). Ensure a default `_` arm is supported and evaluate the match expression to the value of the chosen arm.","acceptance_criteria":"- A `match` construct exists with `case` arms returning expressions.\n- Multiple literals can be joined with `|` to share a branch.\n- `_` wildcard matches when no other pattern does.\n- Type-based matches are possible (e.g., variants/structs once implemented) or a plan exists for first-class support.\n- New syntax is documented in `docs/` and covered by compiler tests and `.tea` examples.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-24T19:50:58.85247-05:00","updated_at":"2025-10-25T02:31:26.293141-05:00","closed_at":"2025-10-25T02:31:26.293141-05:00"}
{"id":"tea-23","title":"feat: add const keyword for immutables","description":"Introduce a `const` keyword to define immutable bindings at compile time. Declarations should fail if reassignment is attempted, mirroring Zig's immutable semantics. Update the type checker and runtime representation so constant bindings propagate constness through the pipeline.","acceptance_criteria":"- `const` declarations compile and are enforced as immutable bindings.\n- Reassigning or mutating a `const` binding produces a clear diagnostic.\n- Existing `let` semantics remain unchanged.\n- Document the new keyword in language docs and add `.tea` examples demonstrating correct and failing usage.\n- Compiler tests cover parsing, type checking, and emitted IR/bytecode for const bindings.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-24T19:51:02.230829-05:00","updated_at":"2025-10-24T21:00:56.144082-05:00","closed_at":"2025-10-24T21:00:56.144082-05:00"}
{"id":"tea-24","title":"feat: support string interpolation literals","description":"Add backtick-delimited string literals that allow `${expr}` interpolation inside the literal. Ensure interpolated expressions are evaluated at runtime and concatenated into a single string result. Update the lexer, parser, and runtime string builder to handle this new literal form.","acceptance_criteria":"- Backtick strings (`` `...` ``) parse successfully and permit `${expr}` segments.\n- Interpolated expressions evaluate in place and produce the same value as manual concatenation.\n- Escaping rules are defined for backticks and `${` sequences.\n- Language documentation and `.tea` examples demonstrate interpolated strings.\n- Compiler tests exercise lexing, parsing, and codegen for interpolation.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-24T19:51:05.523242-05:00","updated_at":"2025-10-24T20:32:06.188185-05:00","closed_at":"2025-10-24T20:32:06.188185-05:00"}
{"id":"tea-25","title":"Enums support","description":"Add support for declaring enums in the language, e.g.\n\nenum Color\n  Red\n  Green\n  Blue\nend","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T20:40:37.885385-05:00","updated_at":"2025-10-25T01:34:28.736013-05:00","closed_at":"2025-10-25T01:34:28.736013-05:00"}
{"id":"tea-26","title":"Public vs private functions","description":"Only export functions from modules prefixed with the `pub` keyword.\n\n```\npub def hello(location: String)\n  `Hello #{location`\nend\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T20:59:16.015309-05:00","updated_at":"2025-10-24T23:18:25.154239-05:00","closed_at":"2025-10-24T23:18:25.154239-05:00"}
{"id":"tea-27","title":"Optional values and null","description":"Support optional values that can hold `null` using the `?` suffix syntax.\n\n```\nvar str: String? = null\nstr = \"Hello\"\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T20:59:17.650161-05:00","updated_at":"2025-10-25T11:57:48.915878-05:00","closed_at":"2025-10-25T11:57:48.915878-05:00"}
{"id":"tea-28","title":"Enforce flow-sensitive optional unwrapping","description":"Force `expr!` to type-check only when prior control-flow guarantees the optional is non-nil. Track paths like `if x == nil { return }` so subsequent code can treat `x` as non-optional and emit diagnostics when the unwrap is unsafe.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T23:10:58.701121-05:00","updated_at":"2025-10-24T23:32:22.819618-05:00","closed_at":"2025-10-24T23:32:22.819618-05:00"}
{"id":"tea-29","title":"Implement optional coalesce operator","description":"Add a `??` operator that returns the left operand when it is non-nil, otherwise evaluates and returns the right operand. Ensure it type-checks across optional and non-optional operands, lowers in both VM and AOT backends, and update docs/examples accordingly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T23:11:11.318796-05:00","updated_at":"2025-10-24T23:47:49.356276-05:00","closed_at":"2025-10-24T23:47:49.356276-05:00"}
{"id":"tea-30","title":"Support optional chaining","description":"Introduce optional-chaining syntax (`expr?.prop`, `expr?.call(...)`) that safely navigates optionals without manual nil checks. The chain should short-circuit to nil when any link is nil, type-check against optional receivers, and lower to the VM and LLVM backends. Update docs and add regression examples.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-24T23:11:24.948268-05:00","updated_at":"2025-10-25T01:09:18.544542-05:00","closed_at":"2025-10-25T01:09:18.544542-05:00"}
{"id":"tea-31","title":"Optional values and null","description":"Support optional values that can hold `null` using the `?` suffix syntax.\n\n```\nvar str: String? = null\nstr = \"Hello\"\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-25T12:13:19.60052-05:00","updated_at":"2025-11-10T08:21:16.298659-06:00","closed_at":"2025-11-10T08:21:16.298659-06:00"}
{"id":"tea-32","title":"Replace logical operators with symbols","description":"Update language to use \u0026\u0026 and || instead of the and/or keywords.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-25T15:00:38.060093-05:00","updated_at":"2025-10-25T15:09:19.332634-05:00","closed_at":"2025-10-25T15:09:19.332634-05:00"}
{"id":"tea-33","title":"Refactor enums to use braces","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-25T13:56:43.453626-05:00","updated_at":"2025-10-25T14:43:27.863094-05:00","closed_at":"2025-10-25T14:43:27.863096-05:00"}
{"id":"tea-34","title":"feat: allow match as statement","description":"Expand Tea's match syntax so it can be used as a statement in addition to an expression.\\n\\nGoals:\\n- Permit match blocks where cases omit  and execute statement blocks.\\n- Adjust parser/grammar to recognize statement-form cases and ensure fall-through rules stay explicit.\\n- Update examples and docs to illustrate both expression and statement usage.\\n- Add compiler/runtime tests covering statement-style match control flow.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-26T09:46:13.600008-05:00","updated_at":"2025-10-26T10:19:39.060823-05:00","closed_at":"2025-10-26T10:19:39.060823-05:00"}
{"id":"tea-35","title":"Add union types with type discrimination","description":"## Summary\n- add a `union` type declaration that aggregates multiple types\n- allow unions to include structs and other unions\n- introduce an `is` type test expression for flow control\n\n## Details\n- update the parser, type checker, and runtime to understand union definitions\n- extend pattern matching to support `case is Type` checks\n- ensure `if value is Type` works for any declared type\n- add language examples and documentation describing the new behavior\n- refresh tree-sitter grammar so tooling recognizes unions and type tests\n\n## Testing\n- add examples covering unions inside match expressions and conditionals\n- extend compiler tests to exercise union definitions and `is` expressions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-26T10:43:47.746758-05:00","updated_at":"2025-10-26T10:43:47.749721-05:00","closed_at":"2025-10-26T10:39:36.744183-05:00"}
{"id":"tea-36","title":"Introduce Void return type for empty functions","description":"Currently functions that do not return an explicit value yield Nil, which is still a first-class value used by optionals. Create a new Void type and update the compiler/runtime so implicit-returning functions produce Void instead.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-26T13:06:35.579214-05:00","updated_at":"2025-10-26T13:49:01.154104-05:00","closed_at":"2025-10-26T13:49:01.154104-05:00"}
{"id":"tea-37","title":"tea-8: parser \u0026 AST for errors-as-values","description":"Extend lexer/parser/AST to recognize  declarations, , , and error union annotations. Ensure resolver registers error types/variants and add design sketch baseline.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-26T16:42:24.191091-05:00","updated_at":"2025-10-26T22:14:29.968133-05:00","closed_at":"2025-10-26T22:14:29.968133-05:00"}
{"id":"tea-38","title":"tea-8: type system for errors-as-values","description":"Teach the type checker about error variants, function error unions, throw/try/catch semantics, and result propagation so unions compose correctly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-26T16:42:29.68505-05:00","updated_at":"2025-10-26T22:14:33.624422-05:00","closed_at":"2025-10-26T22:14:33.624422-05:00"}
{"id":"tea-39","title":"tea-8: runtime \u0026 codegen support for errors-as-values","description":"Update bytecode, VM, and LLVM backend to represent error payloads, propagate throws, and execute try/catch control flow correctly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-26T16:42:34.034005-05:00","updated_at":"2025-10-26T22:14:37.005123-05:00","closed_at":"2025-10-26T22:14:37.005123-05:00"}
{"id":"tea-4","title":"Move std.print into std.debug module","description":"Refactor `std.print` into a dedicated `std.debug` module to tighten the standard library organization. Key steps may include:\n- Introducing a `std.debug.print` (or similar) function that re-exports current printing behavior\n- Updating existing imports/usages across examples, tests, and runtime to reference the new module\n- Keeping backwards compatibility where practical, perhaps via a deprecated shim\n- Documenting the new module layout in standard library docs and release notes\nEnsure the move aligns with the emerging module structure and keeps formatting utilities easy to discover.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-23T22:42:42.150908-05:00","updated_at":"2025-10-24T13:50:39.149496-05:00","closed_at":"2025-10-24T00:38:24.531056-05:00"}
{"id":"tea-40","title":"tea-8: tooling, tests, and docs for errors-as-values","description":"Refresh tree-sitter grammar, add examples/tests, and document the new error handling model once implementation lands.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-26T16:42:39.124421-05:00","updated_at":"2025-10-26T22:14:40.196834-05:00","closed_at":"2025-10-26T22:14:40.196834-05:00"}
{"id":"tea-41","title":"Add for-of loop for list iteration","description":"Introduce `for \u003citem\u003e of \u003clist\u003e` syntax to iterate over lists, binding a fresh loop variable per element and executing a block until `end`.\n\n## Example Syntax\n```tea\nvar names = [\"Alice\", \"Bob\", \"Charlie\"]\n\nfor person of names\n  debug.print(greet(person))\nend\n```\n\n## Semantics\n- Evaluate list expression once\n- Bind loop variable per element (block-scoped)\n- Execute block for each element\n- Runs zero times if list is empty\n\n## Implementation Areas\n\n### Parser\n- Add `for` statement form: `for identifier of expression block end`\n- Update grammar.ebnf to include for_statement\n\n### Typechecker\n- Require `expression: List[T]`\n- Infer loop variable type as `T`\n- Emit type error for non-list iterables\n\n### Resolver\n- Introduce loop binding scoped to loop body\n- Handle shadowing rules\n\n### Runtime/Codegen\n- Desugar to index-based iteration over list length\n- Generate bytecode for list iteration\n- Support in AOT backend\n\n### Formatter\n- Preserve `for … of` with two-space indentation\n- `end` terminator alignment\n\n### Diagnostics\n- Clear errors for non-list iterables\n- Clear errors for invalid loop targets\n\n### Documentation \u0026 Examples\n- Add `examples/language/control_flow/for.tea`\n- Update grammar specification\n- Update language reference docs\n\n## Out of Scope (v1)\n- `break`/`continue` statements\n- Multi-binding or destructuring (e.g., `for key, value`)\n- Non-list iterables (dicts, strings, ranges)\n- List comprehensions\n\n## Open Questions\n1. Should it support dict iteration as key/value pairs?\n2. Should it support string iteration as characters?\n3. Should it support ranges (via `range(start, end)`)?\n4. Should we add an `enumerate` form for index + value?\n5. Should loop variable be read-only (immutable)?\n6. Should we permit shadowing of outer variables?\n\n## Recommendations\n- **v1**: Lists only, read-only loop variable\n- **Future**: Dict key/value pairs, string chars, ranges, enumerate via separate issues","design":"## Syntax Design\n```ebnf\nfor_statement = \"for\" identifier \"of\" expression block \"end\" ;\n```\n\nAligns with existing control flow (`while`, `until`, `unless`) using `end` terminator.\n\n## Type System\n- Expression must be `List[T]` for some type `T`\n- Loop variable has type `T` (inferred from list element type)\n- Loop variable is block-scoped, immutable\n\n## Execution Model\nDesugar to:\n```\nvar __list = \u003cexpression\u003e\nvar __index = 0\nwhile __index \u003c list.length(__list)\n  var \u003cidentifier\u003e = __list[__index]\n  \u003cblock\u003e\n  __index = __index + 1\nend\n```\n\n## Error Cases\n- Non-list iterable: \"Cannot iterate over type X, expected List[T]\"\n- Invalid binding target: handled by parser","acceptance_criteria":"- Parses `for \u003cvar\u003e of \u003clist\u003e ... end` syntax correctly\n- Formats for-of loops with proper indentation\n- Typechecks: loop var type equals list element type\n- Rejects non-list iterables with clear error message\n- Executes correctly for non-empty lists\n- Executes correctly for empty lists (zero iterations)\n- New example file `examples/language/control_flow/for.tea` runs successfully\n- Tree-sitter grammar recognizes for-of syntax\n- Parser tests cover for-of statements\n- Runtime tests verify iteration behavior\n- Type checker tests verify List[T] constraint","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-27T20:56:47.725076-05:00","updated_at":"2025-10-27T21:12:17.504794-05:00","closed_at":"2025-10-27T21:12:17.504794-05:00"}
{"id":"tea-42","title":"Eliminate unnecessary parameter stack allocations","description":"Function parameters are currently stored to stack and immediately loaded back, causing unnecessary memory traffic and preventing register allocation.\n\n**Current IR:**\n```llvm\ndefine i64 @sum_to_n(i64 %n) {\n  %n1 = alloca i64          ; ← Unnecessary allocation\n  store i64 %n, ptr %n1\n  ...\n  %n3 = load i64, ptr %n1   ; ← Load from stack\n}\n```\n\n**Goal:**\n- Keep immutable parameters in SSA registers\n- Only allocate stack space for mutable variables\n- Track mutability in LocalVariable struct\n\n**Impact:** 10-30% speedup on function-heavy code","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-10-28T18:40:58.950948-05:00","updated_at":"2025-10-28T18:57:05.406283-05:00","closed_at":"2025-10-28T18:57:05.406283-05:00"}
{"id":"tea-43","title":"Stack-allocate small collections","description":"All strings, lists, and dicts are currently heap-allocated via FFI calls, even when small and fixed-size.\n\n**Optimization:**\n- Inline small strings (\u003c 24 bytes) on stack\n- Inline small lists (\u003c 8 elements) on stack\n- Use LLVM struct values instead of pointers\n- Inline simple operations (len, get) without FFI\n\n**Impact:** 20-50% speedup on collection-heavy code\n**Note:** This is a complex optimization requiring significant codegen changes","design":"## Current State\nAll collections (strings, lists, dicts) are heap-allocated via FFI calls to tea-runtime:\n- Strings: `tea_alloc_string(ptr, len)` → `Box\u003cTeaString\u003e`\n- Lists: `tea_alloc_list(len)` → `Box\u003cTeaList\u003e` \n- Dicts: `tea_dict_new()` → `Box\u003cTeaDict\u003e`\n\n## Small String Optimization Design\nCreate stack-allocated string representation for strings \u003c 24 bytes:\n\n```llvm\n; Small string struct (24 bytes total on x64)\n%SmallString = type {\n  i8,      ; tag: 0=heap, 1=inline\n  i8,      ; length (0-22)\n  [22 x i8] ; inline data\n}\n\n; Heap string struct (16 bytes)\n%HeapString = type {\n  i8,      ; tag: 0\n  i8,      ; padding\n  i64,     ; length\n  ptr      ; data pointer\n}\n```\n\n**Implementation:**\n- At compile time, check if string literal length \u003c 23\n- If small: allocate `SmallString` on stack, set tag=1, copy bytes inline\n- If large: use existing heap allocation\n- Inline `len()` operation: check tag, return inline length or heap length\n- Inline `get()` operation: check tag, index into inline data or heap data\n\n## Small List Optimization Design\nCreate stack-allocated list for lists with \u003c 8 elements:\n\n```llvm\n; Small list struct (72 bytes on x64)\n%SmallList = type {\n  i8,      ; tag: 0=heap, 1=inline\n  i8,      ; length (0-7)\n  [8 x %TeaValue] ; inline elements (64 bytes)\n}\n\n; Heap list struct (24 bytes)\n%HeapList = type {\n  i8,      ; tag: 0\n  i8,      ; padding\n  i64,     ; length\n  i64,     ; capacity\n  ptr      ; items pointer\n}\n```\n\n**Implementation:**\n- At compile time, check if list literal has \u003c 8 elements\n- If small: allocate `SmallList` on stack, set tag=1, initialize inline elements\n- If large: use existing heap allocation\n- Inline `len()`: check tag, return inline count or heap count\n- Inline `get(i)`: check tag, index into inline array or heap array\n\n## Dict Optimization\nDicts remain heap-allocated (HashMap complexity requires heap). However, inline common operations:\n- Inline `len()`: directly access `dict.entries.len()` without FFI\n- Cache dict pointer instead of reloading\n\n## Implementation Strategy\n1. Add new LLVM struct types for SmallString and SmallList\n2. Modify `compile_string_literal()` to choose inline vs heap based on size\n3. Modify `compile_list_literal()` to choose inline vs heap based on element count\n4. Add helper methods `inline_string_len()`, `inline_list_len()`, `inline_list_get()`\n5. Update `load_from_pointer()` to handle tagged union types\n6. Update runtime operations to handle both representations\n\n## Compatibility\n- Keep existing runtime FFI functions for large collections\n- Tagged union ensures both paths work correctly\n- No ABI changes needed for function signatures (still use %TeaValue)\n\n## Performance Impact\n- Small strings: eliminate FFI call + heap allocation (20-50% faster)\n- Small lists: eliminate FFI call + heap allocation (20-50% faster)\n- Inlined operations: avoid FFI overhead (2-5x faster for len/get)","notes":"## SmallString Implementation Complete ✓\n\nSuccessfully implemented the small string optimization as designed:\n\n### Implementation Details\n1. **LLVM Struct Type (24 bytes):**\n   - `tag: i8` (0=heap, 1=inline)\n   - `len: i8` (length for inline strings)\n   - `data: [22 x i8]` (inline data OR first 8 bytes hold heap pointer)\n\n2. **Compiler Changes:**\n   - Modified `compile_string_literal()` to route based on string length\n   - Created `compile_small_string_literal()` for strings \u003c 23 bytes (heap-allocates the struct)\n   - Created `compile_heap_string_literal()` for strings \u003e= 23 bytes (uses existing logic)\n   - Fixed `concat_string_values()` to call runtime `tea_string_concat()` instead of inline implementation\n\n3. **Runtime Changes:**\n   - Updated `TeaString` struct to tagged union layout\n   - Created `tea_string_len()` helper to extract length from either representation\n   - Created `tea_string_as_bytes()` helper to extract byte slice from either representation\n   - Updated all string operations: print, concat, equal, indexing, slicing\n\n4. **Testing:**\n   - Created `examples/test_small_string.tea` with various string sizes\n   - All existing tests pass including error handling with string interpolation\n   - Verified both inline and heap strings work correctly\n\n### Performance Characteristics\n- Strings \u003c 23 bytes: Stored inline (tag=1), no separate heap allocation for data\n- Strings \u003e= 23 bytes: Heap-allocated data (tag=0), pointer stored in data array\n- All string operations check tag and handle both cases transparently\n\n## SmallList Implementation Complete ✓\n\nSuccessfully implemented the small list optimization:\n\n### Implementation Details\n1. **LLVM Struct Type (136 bytes):**\n   - `tag: i8` (0=heap, 1=inline)\n   - `len: i8` (length for inline lists 0-7)\n   - `padding: [6 x i8]` (alignment)\n   - `data: [8 x TeaValue]` (inline items OR first 24 bytes hold heap info)\n\n2. **Compiler Changes:**\n   - Modified `compile_list_literal()` to route based on element count\n   - Created `compile_small_list_literal()` for lists \u003c 8 elements\n   - Created `compile_heap_list_literal()` for lists \u003e= 8 elements\n\n3. **Runtime Changes:**\n   - Updated `TeaList` struct to tagged union layout\n   - Created `tea_list_len()` helper to extract length from either representation\n   - Created `tea_list_items()` and `tea_list_items_mut()` helpers to access items\n   - Updated all list operations: get, set, print, concat, slice, len, etc.\n\n4. **Testing:**\n   - Created `examples/test_small_list.tea` with various list sizes\n   - All existing tests pass\n   - Verified both inline and heap lists work correctly\n\n### Performance Characteristics\n- Lists \u003c 8 elements: Stored inline (tag=1), no separate heap allocation for items\n- Lists \u003e= 8 elements: Heap-allocated items (tag=0), pointer stored in data array\n- All list operations check tag and handle both cases transparently\n\n## Summary\n\nBoth SmallString and SmallList optimizations are complete and working! This eliminates heap allocations for most string and list literals in typical Tea programs, significantly reducing allocation overhead.\n\n### Next Steps (Future Work)\n- [ ] Benchmark performance improvements\n- [ ] Consider similar optimizations for other types\n- [ ] Document performance impact in CHANGELOG","status":"closed","priority":1,"issue_type":"feature","assignee":"assistant","created_at":"2025-10-28T18:41:02.461204-05:00","updated_at":"2025-12-03T23:46:51.228296-06:00","closed_at":"2025-12-03T23:46:51.228296-06:00"}
{"id":"tea-44","title":"Add inlining hints for small pure functions","description":"LLVM doesn't have enough information to aggressively inline small functions.\n\n**Add attributes:**\n- `alwaysinline` for functions \u003c 10 LLVM instructions\n- `inlinehint` for pure functions without side effects\n- Consider function size and purity during codegen\n\n**Impact:** 5-15% speedup across the board\n**Complexity:** Low - just need to add attributes based on function analysis","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-28T18:41:03.867366-05:00","updated_at":"2025-10-28T19:07:12.617917-05:00","closed_at":"2025-10-28T19:07:12.617917-05:00"}
{"id":"tea-45","title":"Implement tail call optimization","description":"Recursive functions don't use tail calls, limiting recursion depth and missing optimization opportunities.\n\n**Implementation:**\n- Detect tail-recursive call patterns\n- Add `musttail` attribute to tail calls\n- Consider transforming tail recursion to loops\n\n**Impact:** Enables deep recursion (constant stack), same runtime performance\n**Benefit:** Unlocks patterns that would otherwise stack overflow","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-28T18:41:06.323952-05:00","updated_at":"2025-10-28T19:12:05.802969-05:00","closed_at":"2025-10-28T19:12:05.802969-05:00"}
{"id":"tea-46","title":"Add constant folding in codegen","description":"Some compile-time constants are evaluated at runtime instead of being folded during codegen.\n\n**Optimize:**\n- Fold constant arithmetic at compile time\n- Pre-compute string concatenations of literals\n- Cache frequently used constant values\n\n**Impact:** 2-5% speedup\n**Complexity:** Low - add constant evaluation during expression compilation","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-28T18:41:09.016127-05:00","updated_at":"2025-10-28T19:08:00.165268-05:00","closed_at":"2025-10-28T19:08:00.165268-05:00"}
{"id":"tea-47","title":"Improve memory-to-register promotion for top-level bindings","description":"Top-level const/var bindings use global memory instead of registers, preventing optimization.\n\n**Current:**\n```llvm\nstore i64 0, ptr @.binding.i, align 4  ; ← Global memory\n%i = load i64, ptr @.binding.i, align 4\n```\n\n**Fix:**\n- Allocate top-level vars on stack in main\n- Pass as parameters to functions when needed\n- Use thread-local storage for true globals\n\n**Impact:** 5-10% speedup","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-10-28T18:41:10.933123-05:00","updated_at":"2025-12-03T23:47:13.592928-06:00","closed_at":"2025-12-03T23:47:13.592928-06:00"}
{"id":"tea-48","title":"Add loop metadata for vectorization","description":"Add LLVM metadata to loops to enable better optimization and vectorization.\n\n**Add metadata:**\n- `!llvm.loop` metadata with unroll hints\n- `!range` metadata for loop bounds\n- `!invariant.load` for immutable reads\n- Vectorization hints where applicable\n\n**Impact:** 0-5% (might enable auto-vectorization in some cases)\n**Complexity:** Low - add metadata during loop codegen","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-10-28T18:41:13.200808-05:00","updated_at":"2025-10-28T19:30:21.295762-05:00","closed_at":"2025-10-28T19:30:21.295762-05:00"}
{"id":"tea-49","title":"Enable LLVM Link-Time Optimization (LTO)","description":"Add support for LTO to enable cross-module optimization during linking.\n\n**Implementation:**\n- Add `--lto` flag (thin/full)\n- Pass LTO flags to rustc during linking\n- Enable cross-module inlining and optimization\n\n**Impact:** 5-10% speedup (with slower compile time)\n**Trade-off:** Compilation time increases significantly","notes":"Added --lto flag to CLI. However, full LTO support requires LLVM bitcode to be embedded in Tea object files, which needs more complex implementation. Current implementation only enables LTO for Rust runtime code. Marking as blocked pending bitcode emission support.","status":"blocked","priority":3,"issue_type":"feature","created_at":"2025-10-28T18:41:15.742531-05:00","updated_at":"2025-10-28T19:20:38.553557-05:00"}
{"id":"tea-5","title":"Add GitHub Action for PR builds","description":"Introduce GitHub Actions CI coverage for pull requests to ensure build and test checks run automatically. An initial workflow could:\n- Trigger on `pull_request` (and optionally `push` to main branches)\n- Install required toolchains (Rust stable, LLVM dependencies)\n- Run `cargo fmt --check`, `cargo clippy` (if configured), and `cargo test --workspace`\n- Invoke `cargo run -p tea-cli -- test --fail-fast` and `scripts/e2e.sh` where feasible\n- Cache build artifacts to speed up subsequent runs and upload sanitized logs on failure.\nDocument the workflow expectations so contributors understand the gates before merging.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-23T22:59:19.912801-05:00","updated_at":"2025-10-24T13:50:39.149217-05:00","closed_at":"2025-10-24T00:38:27.777389-05:00"}
{"id":"tea-50","title":"Add Profile-Guided Optimization (PGO) support","description":"Implement PGO to optimize based on real-world program behavior.\n\n**Implementation:**\n- Add `--pgo-instrument` flag to generate instrumented binary\n- Add `--pgo-use=profile.data` flag to use profile data\n- Pass PGO flags through to LLVM and rustc\n\n**Impact:** 10-20% speedup for real workloads\n**Workflow:**\n1. Build with `--pgo-instrument`\n2. Run representative workload\n3. Rebuild with `--pgo-use` for optimal performance","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-10-28T18:41:18.917297-05:00","updated_at":"2025-10-29T21:37:10.989771-05:00","closed_at":"2025-10-29T21:37:10.989771-05:00"}
{"id":"tea-51","title":"Implement custom memory allocator","description":"Replace default allocator with specialized allocators for different allocation patterns.\n\n**Allocator strategies:**\n- Arena allocator for temporary objects\n- Bump allocator for linear access patterns\n- Pool allocator for fixed-size objects (strings, list nodes)\n- Thread-local allocation pools\n\n**Impact:** 5-15% speedup for allocation-heavy code\n**Complexity:** High - requires runtime changes","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-10-28T18:41:21.182877-05:00","updated_at":"2025-12-03T23:47:15.965181-06:00","closed_at":"2025-12-03T23:47:15.965181-06:00"}
{"id":"tea-52","title":"Add specialized fast paths for primitive operations","description":"Avoid FFI and boxing overhead for primitive type operations.\n\n**Optimizations:**\n- Inline `+` operator for Int/Float (no FFI call)\n- Inline `len()` for arrays (direct field access)\n- Avoid boxing arithmetic results\n- Use native LLVM operations directly\n\n**Impact:** 30-50% speedup for arithmetic-heavy code\n**Complexity:** Medium - requires recognizing patterns and generating specialized code","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-28T18:41:23.629592-05:00","updated_at":"2025-10-28T19:02:58.541735-05:00","closed_at":"2025-10-28T19:02:58.541735-05:00"}
{"id":"tea-53","title":"Add SIMD vectorization support","description":"Leverage SIMD instructions for data-parallel operations.\n\n**Implementation:**\n- Auto-vectorize loops where possible\n- Add SIMD intrinsics for math operations\n- Use LLVM's SLP vectorizer hints\n- Add explicit vectorization pragmas/attributes\n\n**Impact:** 2-8x speedup for data-parallel code (arrays, matrices)\n**Complexity:** High - requires sophisticated loop analysis","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-10-28T18:41:25.47106-05:00","updated_at":"2025-10-29T21:41:56.867828-05:00","closed_at":"2025-10-29T21:41:56.867828-05:00"}
{"id":"tea-54","title":"Add loop metadata for vectorization","description":"Add LLVM metadata to loops to enable better optimization and vectorization.\n\n**Add metadata:**\n- `!llvm.loop` metadata with unroll hints\n- `!range` metadata for loop bounds\n- `!invariant.load` for immutable reads\n- Vectorization hints where applicable\n\n**Impact:** 0-5% (might enable auto-vectorization in some cases)\n**Complexity:** Low - add metadata during loop codegen","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-10-28T19:51:40.339383-05:00","updated_at":"2025-11-10T08:21:16.177406-06:00","closed_at":"2025-11-10T08:21:16.177406-06:00"}
{"id":"tea-55","title":"Optimize AOT compiler to match Rust performance","description":"The Tea AOT compiler currently generates binaries that are 1.17x to 57.8x slower than equivalent Rust code. Analysis shows this is due to specific code generation issues that can be fixed:\n\n**Current Performance:**\n- loops: 111ms (57.8x slower than Rust's 1.9ms)\n- strings: 30ms (14.9x slower than Rust's 2ms)\n- math: 26ms (7.2x slower than Rust's 3.7ms)\n- dicts: 19.5ms (3.3x slower than Rust's 6ms)\n- fib: 206ms (1.17x slower than Rust's 176ms) ✅\n\n**Root Causes:**\n1. Loop variables use stack allocations (load/store) instead of SSA registers (PHI nodes)\n2. Top-level variables use global memory instead of stack/registers\n3. Primitive operations call FFI runtime instead of inline LLVM instructions\n\n**Target:** Match or exceed Rust performance on all benchmarks","design":"## Design\n\n### Phase 1: Use SSA for Immutable Variables (Target: 50x speedup on loops)\n\n**Current LLVM IR:**\n```llvm\ndefine i64 @sum_to_n(i64 %n) {\n  %i = alloca i64           ; ← Stack allocation\n  %total = alloca i64\n  store i64 0, ptr %total\n  store i64 1, ptr %i\n  \n  loop_body:\n    %total2 = load i64, ptr %total  ; ← 4 loads + 2 stores per iteration\n    %i3 = load i64, ptr %i\n    %addtmp = add i64 %total2, %i3\n    store i64 %addtmp, ptr %total\n}\n```\n\n**Target LLVM IR:**\n```llvm\ndefine i64 @sum_to_n(i64 %n) {\n  br label %loop_cond\n\nloop_cond:\n  %i.phi = phi i64 [ 1, %entry ], [ %i.next, %loop_body ]\n  %total.phi = phi i64 [ 0, %entry ], [ %total.next, %loop_body ]\n  ; ... no memory operations!\n\nloop_body:\n  %total.next = add i64 %total.phi, %i.phi    ; ← Pure register ops\n  %i.next = add i64 %i.phi, 1\n}\n```\n\n**Implementation:**\n\n1. Modify `LocalVariable` usage to distinguish mutable vs immutable:\n   - Immutable: Store `value` (SSA), leave `pointer` as None\n   - Mutable: Store `pointer`, leave `value` as None\n\n2. In `compile_var_statement`:\n   - Check `var_stmt.is_const` or use `find_mutated_in_statements`\n   - For immutable: Store SSA value directly\n   - For mutable: Allocate stack space\n\n3. In `compile_loop_statement`:\n   - Use PHI nodes for loop variables\n   - Track SSA values across loop iterations\n\n4. In `compile_identifier_expression`:\n   - For immutable vars: Return SSA value directly\n   - For mutable vars: Load from pointer\n\n### Phase 2: Move Globals to Stack\n\n1. In `compile_main`:\n   - Allocate stack space for top-level vars\n   - Pass as arguments to functions if needed\n   - Or use SSA for const globals\n\n### Phase 3: Inline Primitive Operations\n\n1. String concatenation: Detect small constant strings, fold at compile-time\n2. Arithmetic: Already inlined, ensure no unnecessary boxing\n3. Collection operations: Inline len(), get() for small fixed-size collections\n\n**Code Locations:**\n- `tea-compiler/src/aot/mod.rs:480-490` (LocalVariable struct)\n- `tea-compiler/src/aot/mod.rs:1462-1520` (Loop compilation)\n- `tea-compiler/src/aot/mod.rs:1787-1810` (Global variables)\n- `tea-compiler/src/aot/mod.rs:1152-1237` (Function parameters)","acceptance_criteria":"## Acceptance Criteria\n\n### Phase 1: SSA for Immutable Variables\n- [ ] Immutable local variables use SSA values (no alloca/load/store)\n- [ ] Loop variables use PHI nodes\n- [ ] Function parameters that aren't mutated use SSA\n- [ ] Loops benchmark: \u003c 5ms (down from 111ms, target: ~2ms to match Rust)\n- [ ] All tests pass\n\n### Phase 2: Stack Locals\n- [ ] Top-level variables allocated on stack in main\n- [ ] No global variables for mutable bindings\n- [ ] All benchmarks improve by 2-3x\n\n### Phase 3: Inline Primitives\n- [ ] Arithmetic operations fully inlined (no FFI)\n- [ ] Small string operations optimized\n- [ ] Math benchmark: \u003c 5ms (down from 26ms)\n- [ ] Strings benchmark: \u003c 5ms (down from 30ms)\n\n### Overall Success\n- [ ] All benchmarks within 2x of Rust (minimum)\n- [ ] At least 3 benchmarks match or beat Rust (target)\n- [ ] No performance regression on fib benchmark\n- [ ] Generated LLVM IR shows PHI nodes in loops\n- [ ] Generated LLVM IR shows no unnecessary memory operations","notes":"## Latest Benchmark Results (Oct 31, 2024)\n\n| Benchmark | Tea AOT | Rust | Relative Performance | Status |\n|-----------|---------|------|---------------------|---------|\n| **loops** | 1.1 ms | 1.1 ms | ✅ Tea 1.03x faster | COMPLETE |\n| **fib** | 171 ms | 193 ms | ✅ Tea 1.13x faster | COMPLETE |\n| **math** | 4.8 ms | 3.0 ms | Rust 1.62x faster | Needs work |\n| **dicts** | 15.8 ms | 6.0 ms | Rust 2.65x faster | Needs work |\n| **strings** | 130.9 ms | 2.0 ms | Rust 63.94x faster | **ALGORITHMIC ISSUE** |\n\n**Note on strings benchmark**: The Tea implementation uses `result = result + \"x\"` which creates O(n²) allocations, while Rust uses `result.push('x')` which is O(n). This is not a compiler optimization issue but rather a missing mutable string append API in the stdlib.\n\n**Major Success**: Tea now matches or beats Rust on loops and fibonacci benchmarks! The original goal of matching Rust performance has been largely achieved.\n\n**Remaining Work**: \n- Math benchmark needs optimization (likely related to arithmetic operations)\n- Dicts benchmark could use improvement (likely FFI overhead)\n- Strings benchmark needs a proper mutable string builder API in stdlib","status":"closed","priority":1,"issue_type":"task","assignee":"assistant","created_at":"2025-10-29T22:37:41.116095-05:00","updated_at":"2025-12-03T23:47:17.409791-06:00","closed_at":"2025-12-03T23:47:17.409791-06:00"}
{"id":"tea-56","title":"Remove VM backend and consolidate on AOT-only compilation","description":"Remove the bytecode VM backend (~7K lines) to simplify the codebase and focus development efforts on the LLVM AOT compiler. This will eliminate ~18K lines of dual-backend code and redirect resources toward incremental compilation, better tooling, and language features.","design":"## Rationale\n- VM is substantially slower than AOT\n- Maintaining two code generation pipelines is expensive\n- VM is already marginalized (opt-in for benchmarks, can't be used with `tea build`)\n- Rust's AOT-only model proves this approach works well\n\n## Approach\n1. Audit what VM code is actually needed by AOT\n2. Remove VM-specific code (bytecode, VM, codegen)\n3. Update CLI to remove bytecode backend option\n4. Update tests to use AOT path exclusively\n5. Update documentation\n6. Clean up any remaining dead code\n\n## Future Optimization\nAfter removal, invest in making AOT compilation faster through caching and incremental compilation.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-07T16:21:22.988023-05:00","updated_at":"2025-11-07T20:41:30.185173-06:00","closed_at":"2025-11-07T20:41:30.185173-06:00"}
{"id":"tea-57","title":"Audit VM code dependencies and identify AOT requirements","description":"Before removing VM code, identify what parts are actually needed by the AOT backend. Check for shared code in runtime/, intrinsics, and value types that AOT relies on.","notes":"# VM Code Audit Summary - tea-57\n\n## Goal\nIdentify what VM-related code is actually needed by the AOT backend before removal.\n\n## Key Findings\n\n### 1. AOT Dependencies on Runtime Module\n\n**AOT DOES use:**\n- `Intrinsic` enum (tea-compiler/src/runtime/intrinsics.rs:334-406)\n  - Used in compile_call_expression() to dispatch to specialized intrinsic handlers\n  - ~70 variants corresponding to StdFunctionKind values\n  - Comment says: \"Keep the old Intrinsic enum for backward compatibility with AOT\"\n  - Location: tea-compiler/src/aot/mod.rs uses `use crate::runtime::Intrinsic;`\n\n**AOT does NOT use:**\n- `Program` struct (bytecode-specific)\n- `Vm` struct (VM execution engine)\n- `CodeGenerator` (bytecode code generation)\n- `VmSemanticMetadata` (metadata for bytecode generation)\n- `TestOutcome`, `TestRunOptions`, `TestStatus` (VM test execution)\n- `Value` enum (VM runtime values)\n- Bytecode instructions\n\n### 2. Compiler.rs Dependencies\n\nThe `Compiler::compile()` method (tea-compiler/src/compiler.rs) currently:\n- Creates `VmSemanticMetadata` (line 266-276)\n- Creates `CodeGenerator` (line 277)\n- Generates `Program` (line 278)\n- Returns `Compilation { module, program, ... }` (line 280-287)\n\n**Impact:** The compiler always generates both bytecode AND module AST, even for AOT builds.\n\n### 3. CLI Usage\n\ntea-cli/src/main.rs uses:\n- `compilation.program` → Only for VM execution and bytecode emission\n- `compilation.module` → For AOT compilation (passed to aot::compile_module_to_llvm_ir())\n\n### 4. Intrinsic System Architecture\n\nCurrent structure:\n```\ntea-compiler/src/runtime/intrinsics.rs:\n  - IntrinsicDef struct (line 42-49) - metadata for VM intrinsics\n  - INTRINSICS registry (line 52-331) - array of IntrinsicDef\n  - Intrinsic enum (line 334-406) - for AOT backward compat\n  \nAOT needs:\n  - Intrinsic enum only (for pattern matching in compile_call_expression)\n  - Does NOT need IntrinsicDef, INTRINSICS, or VM implementations\n```\n\n### 5. Files to Remove (VM-only)\n\n**Safe to delete entirely:**\n1. tea-compiler/src/runtime/vm.rs (~1500 lines)\n2. tea-compiler/src/runtime/bytecode.rs (~500 lines)  \n3. tea-compiler/src/runtime/codegen.rs (~2500 lines)\n4. tea-compiler/src/runtime/value.rs (~800 lines) - VM runtime values\n5. tea-compiler/src/runtime/cli.rs - VM CLI support\n6. tea-compiler/src/runtime/intrinsics_impl/* - VM intrinsic implementations (7 files)\n\n**Total: ~7,000 lines**\n\n### 6. Files to Modify (Shared Code)\n\n**tea-compiler/src/runtime/intrinsics.rs:**\n- KEEP: Intrinsic enum (lines 334-406)\n- REMOVE: IntrinsicDef struct, INTRINSICS registry, define_intrinsics macro\n- MOVE: Intrinsic enum to a better location (maybe tea-compiler/src/stdlib.rs)\n\n**tea-compiler/src/runtime/mod.rs:**\n- REMOVE: All exports except possibly Intrinsic\n- May delete entirely if Intrinsic is moved\n\n**tea-compiler/src/compiler.rs:**\n- REMOVE: VmSemanticMetadata creation (lines 266-276)\n- REMOVE: CodeGenerator usage (line 277-278)\n- REMOVE: program field from Compilation struct\n- Keep only: module field\n\n**tea-compiler/src/lib.rs:**\n- REMOVE: Program, Vm, TestOutcome, TestRunOptions, TestStatus exports\n- REMOVE: runtime module re-exports\n\n### 7. Intrinsic Enum Should Be Moved\n\nThe Intrinsic enum is really a compile-time construct (maps StdFunctionKind to AOT code gen).\nIt should live with the AOT compiler, not in runtime/.\n\n**Proposed location:**\n- Move to: tea-compiler/src/aot/intrinsics.rs\n- Or integrate into: tea-compiler/src/stdlib.rs (alongside StdFunctionKind)\n\n### 8. Simplified Compilation Flow (After VM Removal)\n\nCurrent:\n```\nCompiler::compile() \n  → parse + resolve + typecheck\n  → generate VM bytecode (CodeGenerator)\n  → return Compilation { module, program }\n```\n\nAfter:\n```\nCompiler::compile()\n  → parse + resolve + typecheck  \n  → return Compilation { module }\n```\n\nAOT compilation then:\n```\naot::compile_module_to_llvm_ir(\u0026compilation.module)\n```\n\n## Summary\n\n**What AOT needs from runtime/:**\n1. Intrinsic enum (~70 lines) - should be moved to aot/ or stdlib\n\n**What can be removed:**\n1. vm.rs, bytecode.rs, codegen.rs, value.rs, cli.rs (~5000 lines)\n2. intrinsics_impl/* (7 files, ~2000 lines)  \n3. Most of intrinsics.rs (keep only Intrinsic enum)\n4. Program struct and bytecode-related code\n\n**Total savings: ~7000 lines in tea-compiler/src/runtime/**\n\n## Recommendation\n\n1. Move Intrinsic enum to tea-compiler/src/aot/intrinsics.rs\n2. Delete entire tea-compiler/src/runtime/ directory\n3. Update Compiler to not generate bytecode\n4. Update Compilation struct to only contain module\n5. Remove VM-related exports from lib.rs\n\nThis makes the AOT backend completely independent of VM code.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-07T16:21:25.555123-05:00","updated_at":"2025-11-07T16:30:07.928486-05:00","closed_at":"2025-11-07T16:30:07.928486-05:00","dependencies":[{"issue_id":"tea-57","depends_on_id":"tea-58","type":"blocks","created_at":"2025-11-07T16:22:01.147493-05:00","created_by":"bentruyman","metadata":"{}"},{"issue_id":"tea-57","depends_on_id":"tea-56","type":"parent-child","created_at":"2025-11-07T16:22:15.642184-05:00","created_by":"bentruyman","metadata":"{}"}]}
{"id":"tea-58","title":"Remove bytecode backend option from CLI","description":"Remove the --backend flag and Backend enum from tea-cli. Make LLVM the only backend. Update run_program() to always use AOT compilation. Remove Backend::Bytecode variant and all associated code paths.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-07T16:21:27.93815-05:00","updated_at":"2025-11-07T16:36:01.236729-05:00","closed_at":"2025-11-07T16:36:01.236729-05:00","dependencies":[{"issue_id":"tea-58","depends_on_id":"tea-59","type":"blocks","created_at":"2025-11-07T16:22:01.88837-05:00","created_by":"bentruyman","metadata":"{}"},{"issue_id":"tea-58","depends_on_id":"tea-60","type":"blocks","created_at":"2025-11-07T16:22:02.532022-05:00","created_by":"bentruyman","metadata":"{}"},{"issue_id":"tea-58","depends_on_id":"tea-56","type":"parent-child","created_at":"2025-11-07T16:22:16.275836-05:00","created_by":"bentruyman","metadata":"{}"}]}
{"id":"tea-59","title":"Remove VM and bytecode code generation from tea-compiler","description":"Remove tea-compiler/src/runtime/{vm.rs, bytecode.rs, codegen.rs}. These files implement the bytecode VM and bytecode code generation which are no longer needed with AOT-only approach.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-07T16:21:30.184233-05:00","updated_at":"2025-11-07T16:40:57.809796-05:00","closed_at":"2025-11-07T16:40:57.809796-05:00","dependencies":[{"issue_id":"tea-59","depends_on_id":"tea-61","type":"blocks","created_at":"2025-11-07T16:22:03.595061-05:00","created_by":"bentruyman","metadata":"{}"},{"issue_id":"tea-59","depends_on_id":"tea-56","type":"parent-child","created_at":"2025-11-07T16:22:17.008158-05:00","created_by":"bentruyman","metadata":"{}"}]}
{"id":"tea-6","title":"Create Language Server Protocol implementation","description":"Build an LSP server for Tea to bring editor integration up to par. Initial feature set should prioritize:\n- Syntax-aware diagnostics surfaced as users type (compilation errors, lexical issues)\n- Go-to-definition, hover tooltips, and symbol lookup based on the compiler’s semantic model\n- Formatting hooks that leverage `tea-cli fmt`\n- Incremental analysis and caching so feedback stays responsive on larger projects\n- Extensible architecture for future features such as inline evaluation or refactorings.\nDocument setup instructions for popular editors (VS Code, Neovim, Helix) and provide demos or GIFs once functional.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-23T22:59:25.669345-05:00","updated_at":"2025-10-24T23:21:42.391829-05:00","closed_at":"2025-10-24T23:21:42.391829-05:00"}
{"id":"tea-60","title":"Update test command to use AOT backend","description":"The `tea test` command currently uses the VM (see tea-cli/src/main.rs:422). Update it to compile and run tests using the AOT backend instead. This may require restructuring how tests are discovered and executed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-07T16:21:32.398811-05:00","updated_at":"2025-11-07T16:51:50.203509-05:00","closed_at":"2025-11-07T16:51:50.203509-05:00","dependencies":[{"issue_id":"tea-60","depends_on_id":"tea-56","type":"parent-child","created_at":"2025-11-07T16:22:17.691736-05:00","created_by":"bentruyman","metadata":"{}"}]}
{"id":"tea-61","title":"Update compiler tests to use AOT instead of VM","description":"Update all integration tests in tea-compiler/tests/ that currently use the VM to use AOT compilation. Search for Vm::new() usage and replace with AOT compilation path.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-07T16:21:34.345013-05:00","updated_at":"2025-11-07T20:40:47.326467-06:00","closed_at":"2025-11-07T20:40:47.326467-06:00","dependencies":[{"issue_id":"tea-61","depends_on_id":"tea-63","type":"blocks","created_at":"2025-11-07T16:22:04.711819-05:00","created_by":"bentruyman","metadata":"{}"},{"issue_id":"tea-61","depends_on_id":"tea-56","type":"parent-child","created_at":"2025-11-07T16:22:18.4003-05:00","created_by":"bentruyman","metadata":"{}"}]}
{"id":"tea-63","title":"Clean up Program struct and compilation artifacts","description":"The Compilation struct likely contains both bytecode (program.chunk) and AOT artifacts. Remove bytecode-specific fields from Program and Compilation structs. Keep only what's needed for AOT.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-07T16:21:38.45841-05:00","updated_at":"2025-11-07T20:40:54.630834-06:00","closed_at":"2025-11-07T20:40:54.630834-06:00","dependencies":[{"issue_id":"tea-63","depends_on_id":"tea-56","type":"parent-child","created_at":"2025-11-07T16:22:19.793967-05:00","created_by":"bentruyman","metadata":"{}"}]}
{"id":"tea-66","title":"Run full test suite and fix any regressions","description":"Run `cargo test --workspace` and `scripts/e2e.sh` to ensure all tests pass with AOT-only backend. Fix any issues that arise from the VM removal.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-07T16:21:44.184507-05:00","updated_at":"2025-11-07T20:41:29.338458-06:00","closed_at":"2025-11-07T20:41:29.338458-06:00","dependencies":[{"issue_id":"tea-66","depends_on_id":"tea-56","type":"parent-child","created_at":"2025-11-07T16:22:21.100142-05:00","created_by":"bentruyman","metadata":"{}"}]}
{"id":"tea-67","title":"Lexer/Parser: Add `@` prefix support for built-in functions","description":"Add support for parsing built-in functions with `@` prefix (e.g. `@print()`, `@len()`, `@panic()`)","design":"- Lexer: Add token type for `@` symbol or built-in identifier\n- Parser: Parse `@identifier(args)` as built-in function call\n- Update grammar to support `@` prefix\n- Ensure built-in calls are distinguished from regular function calls in AST","acceptance_criteria":"- Can parse `@print(\"hello\")` without syntax errors\n- Can parse all new built-in function names with `@` prefix\n- AST correctly represents built-in vs regular function calls\n- Tests pass for built-in function parsing","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-09T18:06:59.327333-06:00","updated_at":"2025-11-09T18:15:37.258633-06:00","closed_at":"2025-11-09T18:15:37.258633-06:00"}
{"id":"tea-68","title":"Built-ins: Add new debug built-ins (@println, @to_string, @type_of)","description":"Add three new debug built-in functions: @println (print with newline), @to_string (convert any value to string), @type_of (get runtime type as string)","design":"- @println(value: Unknown) -\u003e Void: prints value to stderr with newline\n- @to_string(value: Unknown) -\u003e String: expose existing intrinsic\n- @type_of(value: Unknown) -\u003e String: returns type name (\"Int\", \"String\", \"List\", etc.)\n- Add to BUILTINS array in builtins.rs\n- Implement in AOT compiler\n- Add runtime support if needed","acceptance_criteria":"- @println() works and adds newline after output\n- @to_string() converts all types to string representation\n- @type_of() returns correct type names for all types\n- All three functions work in compiled code\n- Tests pass","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-09T18:07:05.156717-06:00","updated_at":"2025-11-09T18:41:19.070103-06:00","closed_at":"2025-11-09T18:41:19.070103-06:00"}
{"id":"tea-69","title":"Built-ins: Add @panic and remove __intrinsic_fail","description":"Replace __intrinsic_fail with user-facing @panic(message: String) built-in function","design":"- Add @panic(message: String) as built-in\n- Update assert module to use @panic instead of __intrinsic_fail\n- Remove __intrinsic_fail from intrinsics (or keep internal only)\n- @panic should terminate program with error message","acceptance_criteria":"- @panic(\"error\") terminates program with message\n- Assert module uses @panic internally\n- __intrinsic_fail no longer exposed to users\n- Tests pass","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-09T18:07:08.391175-06:00","updated_at":"2025-11-09T19:39:14.913299-06:00","closed_at":"2025-11-09T19:39:14.913299-06:00"}
{"id":"tea-70","title":"Built-ins: Add math built-ins (@floor, @ceil, @round, @abs, @sqrt, @min, @max)","description":"Add seven math built-in functions that work with Float types","design":"- @floor(value: Float) -\u003e Int: rounds down\n- @ceil(value: Float) -\u003e Int: rounds up\n- @round(value: Float) -\u003e Int: rounds to nearest\n- @abs(value: Float) -\u003e Float: absolute value\n- @sqrt(value: Float) -\u003e Float: square root\n- @min(a: Float, b: Float) -\u003e Float: minimum of two values\n- @max(a: Float, b: Float) -\u003e Float: maximum of two values\n- Add intrinsics for floor/ceil/round/sqrt if not already present\n- Implement in AOT compiler with LLVM math intrinsics","acceptance_criteria":"- All seven math built-ins work correctly\n- @floor, @ceil, @round return Int type\n- @abs, @sqrt, @min, @max work with Float type\n- Tests pass with various inputs including edge cases\n- LLVM correctly generates efficient math operations","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-09T18:07:12.9006-06:00","updated_at":"2025-11-09T19:57:53.530056-06:00","closed_at":"2025-11-09T19:57:53.530056-06:00"}
{"id":"tea-71","title":"Built-ins: Rename existing built-ins (print→@print, length→@len, min→@min, max→@max)","description":"Rename existing built-in functions to use @ prefix and new names per spec","design":"- print() -\u003e @print()\n- length() -\u003e @len()\n- min() -\u003e @min() (will be replaced by Float version in TEA-4)\n- max() -\u003e @max() (will be replaced by Float version in TEA-4)\n- Update builtins.rs registration\n- Update AOT compiler call sites\n- Note: min/max currently work with Any type, will need updating for Float-only in TEA-4","acceptance_criteria":"- @print() works (old print() removed)\n- @len() works (old length() removed)\n- @min() and @max() work with @ prefix\n- No references to old names remain in compiler\n- Tests updated and passing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:07:17.866879-06:00","updated_at":"2025-11-09T18:27:39.140092-06:00","closed_at":"2025-11-09T18:27:39.140092-06:00"}
{"id":"tea-72","title":"Built-ins: Remove deprecated built-ins (exit, delete, clear, append)","description":"Remove four built-in functions that are not in the new stdlib spec","design":"- Remove exit() from builtins\n- Remove delete() from builtins (Dict operation)\n- Remove clear() from builtins (Dict operation)\n- Remove append() from builtins (List operation)\n- Remove from BUILTINS array\n- Remove from StdFunctionKind enum\n- Remove AOT compiler implementations\n- Remove any tests that depend on these functions","acceptance_criteria":"- exit(), delete(), clear(), append() no longer available\n- Compiler errors when trying to use these functions\n- All removed from builtins.rs\n- Tests pass (deprecated function tests removed)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:07:21.546567-06:00","updated_at":"2025-11-09T20:02:25.424357-06:00","closed_at":"2025-11-09T20:02:25.424357-06:00"}
{"id":"tea-73","title":"Stdlib: Update assert module (rename assert→ok, remove fail, remove empty)","description":"Update assert module to match new spec: rename assert() to ok(), remove fail() and empty()","design":"- Rename assert(condition, message) -\u003e ok(value) with single param (truthy check)\n- Remove fail() function (replaced by @panic)\n- Remove empty() function (not in spec)\n- Remove all tea_* C symbol exports (tea_assert, tea_fail, etc.)\n- Keep eq(), ne(), snapshot()\n- Update function to use @panic instead of __intrinsic_fail","acceptance_criteria":"- assert.ok(value) works for truthy assertions\n- assert.eq() and assert.ne() still work\n- assert.snapshot() still works\n- fail() and empty() no longer available\n- C symbol exports removed\n- Tests updated and passing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:07:26.427359-06:00","updated_at":"2025-11-09T21:57:37.063846-06:00","closed_at":"2025-11-09T21:57:37.063846-06:00"}
{"id":"tea-74","title":"Stdlib: Update env module (remove unset only)","description":"Remove env.unset() function from env module, keep all other functions","design":"- Remove unset() function from stdlib/env/mod.tea\n- Keep: get(), set(), cwd(), vars()\n- Remove env_unset intrinsic or mark as internal-only\n- Remove from StdFunctionKind enum\n- Update documentation","acceptance_criteria":"- env.get(), env.set(), env.cwd(), env.vars() all work\n- env.unset() no longer available\n- Compiler error when trying to use env.unset()\n- Tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:07:29.640777-06:00","updated_at":"2025-11-09T22:00:55.310996-06:00","closed_at":"2025-11-09T22:00:55.310996-06:00"}
{"id":"tea-75","title":"Stdlib: Update fs module (rename functions, add rename/stat, remove ensure_dir/exists/walk)","description":"Major refactor of fs module: rename functions, add new ones, remove several helpers","design":"Renames:\n- read_text() -\u003e read_file()\n- write_text() -\u003e write_file()\n- list_dir() -\u003e read_dir()\n\nAdditions:\n- rename(source: String, target: String) -\u003e Void\n- stat(path: String) -\u003e FileInfo (need to define FileInfo struct)\n\nRemovals:\n- ensure_dir() (helper function, not in spec)\n- exists() (helper function, not in spec)\n- walk() (recursive helper, not in spec)\n\nUpdate intrinsics and AOT implementations as needed","acceptance_criteria":"- fs.read_file() and fs.write_file() work\n- fs.read_dir() works (renamed from list_dir)\n- fs.rename() implemented and working\n- fs.stat() returns FileInfo with file metadata\n- ensure_dir(), exists(), walk() removed\n- Tests updated and passing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:07:34.591285-06:00","updated_at":"2025-11-09T23:10:38.398541-06:00","closed_at":"2025-11-09T23:10:38.398541-06:00"}
{"id":"tea-76","title":"Stdlib: Update path module (rename components→split, remove normalize/absolute/relative/separator)","description":"Update path module: rename one function and remove four functions","design":"Rename:\n- components() -\u003e split()\n\nKeep:\n- basename(), dirname(), extension(), join()\n\nRemove:\n- normalize() (not in spec)\n- absolute() (not in spec)\n- relative() (not in spec)\n- separator() (not in spec)\n\nUpdate corresponding intrinsics as needed","acceptance_criteria":"- path.split() works (renamed from components)\n- path.basename(), dirname(), extension(), join() still work\n- normalize(), absolute(), relative(), separator() removed\n- Tests updated and passing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:07:37.469116-06:00","updated_at":"2025-11-09T22:39:55.03074-06:00","closed_at":"2025-11-09T22:39:55.03074-06:00"}
{"id":"tea-77","title":"Stdlib: Update string module (add replace, to_lower, to_upper)","description":"Add three new string manipulation functions to string module","design":"Add to stdlib/string/mod.tea:\n- replace(text: String, pattern: String, replacement: String) -\u003e String (use existing string_replace intrinsic)\n- to_lower(text: String) -\u003e String (need new intrinsic)\n- to_upper(text: String) -\u003e String (need new intrinsic)\n\nKeep all existing functions:\n- starts_with(), ends_with(), trim_start(), trim_end(), trim(), reverse()\n\nAdd intrinsics for to_lower/to_upper if not present","acceptance_criteria":"- string.replace() works using intrinsic\n- string.to_lower() converts to lowercase\n- string.to_upper() converts to uppercase\n- All existing string functions still work\n- Tests pass","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-09T18:07:41.999137-06:00","updated_at":"2025-11-09T22:31:15.43286-06:00","closed_at":"2025-11-09T22:31:15.43286-06:00"}
{"id":"tea-78","title":"Stdlib: Remove math module entirely","description":"Remove the entire math standard library module (functions moved to built-ins)","design":"- Delete stdlib/math/mod.tea\n- Remove math module from MODULES array in stdlib/mod.rs\n- Remove any math module references from documentation\n- Functions like abs(), min(), max() now available as @abs(), @min(), @max()\n- Functions like sign(), pow() removed entirely (not in spec)","acceptance_criteria":"- stdlib/math/ directory removed\n- Cannot import \"std.math\"\n- Compiler error when trying to use math module\n- Tests updated to use built-in math functions instead\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:07:46.602968-06:00","updated_at":"2025-11-09T22:27:49.135795-06:00","closed_at":"2025-11-09T22:27:49.135795-06:00"}
{"id":"tea-79","title":"Stdlib: Remove yaml module entirely","description":"Remove the entire yaml standard library module (not in new spec)","design":"- Delete stdlib/yaml/mod.tea\n- Remove yaml module from MODULES array in stdlib/mod.rs\n- Remove yaml intrinsics (yaml_encode, yaml_decode)\n- Remove from StdFunctionKind enum\n- Remove yaml support from AOT compiler\n- Remove any yaml dependencies from Cargo.toml if present","acceptance_criteria":"- stdlib/yaml/ directory removed\n- Cannot import \"std.yaml\"\n- Compiler error when trying to use yaml module\n- yaml intrinsics removed\n- Tests pass (yaml tests removed)\n- No yaml dependencies in project","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:07:49.543412-06:00","updated_at":"2025-11-09T22:28:21.942936-06:00","closed_at":"2025-11-09T22:28:21.942936-06:00"}
{"id":"tea-8","title":"Adopt errors-as-values pattern","description":"Rework error handling so Tea programs can treat errors as first-class values. Key steps could include:\n- Introducing a lightweight result type (e.g., `Result\u003cT, E\u003e`) or equivalent pattern in the language\n- Refactoring the standard library to expose fallible operations via explicit error returns instead of panics or implicit exceptions\n- Updating core language constructs (pattern matching, async) to interoperate smoothly with the new error model\n- Providing ergonomics for error propagation, aggregation, and formatting\n- Documenting migration guidance and updating examples/tests to showcase idiomatic usage.\nEnsure runtime semantics stay predictable and compiler diagnostics guide users toward the new APIs.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-23T22:59:34.686238-05:00","updated_at":"2025-10-26T22:14:43.46611-05:00","closed_at":"2025-10-26T22:14:43.46611-05:00"}
{"id":"tea-80","title":"Intrinsics: Add new intrinsics (type_of, floor, ceil, round, sqrt, to_lower, to_upper, fs_rename, fs_stat)","description":"Add new intrinsic functions needed for new built-ins and stdlib functions","design":"Add to tea-intrinsics:\n- type_of(value: Unknown) -\u003e String: runtime type inspection\n- floor(value: Float) -\u003e Int: LLVM floor intrinsic\n- ceil(value: Float) -\u003e Int: LLVM ceil intrinsic  \n- round(value: Float) -\u003e Int: LLVM round intrinsic\n- sqrt(value: Float) -\u003e Float: LLVM sqrt intrinsic\n- to_lower(text: String) -\u003e String: string lowercase\n- to_upper(text: String) -\u003e String: string uppercase\n- fs_rename(source: String, target: String) -\u003e Void: file rename\n- fs_stat(path: String) -\u003e FileInfo: file metadata\n\nImplement in tea-intrinsics/src/ and expose through AOT compiler","acceptance_criteria":"- All 9 new intrinsics implemented in Rust\n- Exposed through AOT compiler\n- LLVM generates correct code for math intrinsics\n- String case conversion works correctly\n- fs_rename and fs_stat work with filesystem\n- Tests pass for all intrinsics","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-09T18:07:55.039069-06:00","updated_at":"2025-11-09T18:22:28.180163-06:00","closed_at":"2025-11-09T18:22:28.180163-06:00"}
{"id":"tea-81","title":"Intrinsics: Remove yaml intrinsics","description":"Remove yaml_encode and yaml_decode intrinsics","design":"- Remove yaml_encode() from intrinsics\n- Remove yaml_decode() from intrinsics\n- Remove from StdFunctionKind enum\n- Remove from intrinsics module in stdlib\n- Remove AOT compiler implementations\n- Remove yaml-related dependencies if any","acceptance_criteria":"- yaml_encode and yaml_decode removed from codebase\n- No yaml intrinsic references remain\n- Tests pass\n- No yaml dependencies in Cargo.toml","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:07:57.844179-06:00","updated_at":"2025-11-09T22:30:00.676105-06:00","closed_at":"2025-11-09T22:30:00.676105-06:00"}
{"id":"tea-82","title":"Docs: Update all documentation for new stdlib structure","description":"Update all documentation files to reflect new stdlib structure and @ prefix for built-ins","design":"Update documentation:\n- Move docs/new-stdlib.md content to docs/stdlib-reference.md\n- Update docs/intrinsics-reference.md with new intrinsics\n- Update stdlib/README.md to reflect new structure\n- Update main README.md if it mentions stdlib\n- Update AGENTS.md if needed\n- Remove references to removed modules (math, yaml)\n- Document @ prefix for built-ins\n- Update function signatures and examples","acceptance_criteria":"- All docs reflect new stdlib structure\n- @ prefix documented for built-ins\n- No references to removed modules/functions\n- Examples use correct new syntax\n- docs/stdlib-reference.md is authoritative source","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-09T18:08:02.725875-06:00","updated_at":"2025-11-10T07:07:49.027985-06:00","closed_at":"2025-11-10T07:07:49.027985-06:00"}
{"id":"tea-83","title":"Examples: Update all examples to use @ prefix for built-ins","description":"Update all .tea example files to use new @ prefix for built-ins and new stdlib structure","design":"Update all files in examples/:\n- Replace print() with @print()\n- Replace length() with @len()\n- Replace __intrinsic_fail() with @panic()\n- Update math module usage to use built-ins\n- Remove yaml module usage\n- Update fs/path/string module usage with new names\n- Update assert module usage (assert -\u003e ok)\n- Ensure all examples compile and run correctly","acceptance_criteria":"- All examples use @ prefix for built-ins\n- No examples use removed functions/modules\n- All examples use new stdlib function names\n- All examples compile without errors\n- All examples run correctly","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-09T18:08:08.014645-06:00","updated_at":"2025-11-10T08:21:33.28675-06:00","closed_at":"2025-11-10T08:21:33.28675-06:00"}
{"id":"tea-84","title":"Tests: Update all tests for new stdlib and built-ins","description":"Update all test files to use @ prefix for built-ins and new stdlib structure","design":"Update tests in:\n- tea-compiler/tests/*.rs: Update Rust integration tests\n- tests/*.tea: Update Tea test files\n- examples/ test files\n\nChanges:\n- Use @ prefix for all built-ins\n- Update stdlib imports and function names\n- Remove tests for deleted functions/modules\n- Add tests for new built-ins and stdlib functions\n- Ensure all tests pass","acceptance_criteria":"- All tests use @ prefix for built-ins\n- Tests use new stdlib function names\n- No tests reference removed functions/modules\n- New built-ins have test coverage\n- cargo test --workspace passes\n- scripts/e2e.sh passes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-09T18:08:12.949662-06:00","updated_at":"2025-11-10T08:21:34.404533-06:00","closed_at":"2025-11-10T08:21:34.404533-06:00"}
{"id":"tea-85","title":"Built-ins: Add new debug built-ins (@println, @to_string, @type_of)","description":"Add three new debug built-in functions: @println (print with newline), @to_string (convert any value to string), @type_of (get runtime type as string)","design":"- @println(value: Unknown) -\u003e Void: prints value to stderr with newline\n- @to_string(value: Unknown) -\u003e String: expose existing intrinsic\n- @type_of(value: Unknown) -\u003e String: returns type name (\"Int\", \"String\", \"List\", etc.)\n- Add to BUILTINS array in builtins.rs\n- Implement in AOT compiler\n- Add runtime support if needed","acceptance_criteria":"- @println() works and adds newline after output\n- @to_string() converts all types to string representation\n- @type_of() returns correct type names for all types\n- All three functions work in compiled code\n- Tests pass","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-09T18:08:21.969796-06:00","updated_at":"2025-11-10T08:21:15.765452-06:00","closed_at":"2025-11-10T08:21:15.765452-06:00","dependencies":[{"issue_id":"tea-85","depends_on_id":"tea-67","type":"blocks","created_at":"2025-11-09T18:09:15.447842-06:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tea-86","title":"Built-ins: Add @panic and remove __intrinsic_fail","description":"Replace __intrinsic_fail with user-facing @panic(message: String) built-in function","design":"- Add @panic(message: String) as built-in\n- Update assert module to use @panic instead of __intrinsic_fail\n- Remove __intrinsic_fail from intrinsics (or keep internal only)\n- @panic should terminate program with error message","acceptance_criteria":"- @panic(\"error\") terminates program with message\n- Assert module uses @panic internally\n- __intrinsic_fail no longer exposed to users\n- Tests pass","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-09T18:08:25.618681-06:00","updated_at":"2025-11-10T08:21:16.194746-06:00","closed_at":"2025-11-10T08:21:16.194746-06:00","dependencies":[{"issue_id":"tea-86","depends_on_id":"tea-67","type":"blocks","created_at":"2025-11-09T18:09:16.136048-06:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tea-87","title":"Built-ins: Add math built-ins (@floor, @ceil, @round, @abs, @sqrt, @min, @max)","description":"Add seven math built-in functions that work with Float types","design":"- @floor(value: Float) -\u003e Int: rounds down\n- @ceil(value: Float) -\u003e Int: rounds up\n- @round(value: Float) -\u003e Int: rounds to nearest\n- @abs(value: Float) -\u003e Float: absolute value\n- @sqrt(value: Float) -\u003e Float: square root\n- @min(a: Float, b: Float) -\u003e Float: minimum of two values\n- @max(a: Float, b: Float) -\u003e Float: maximum of two values\n- Add intrinsics for floor/ceil/round/sqrt if not already present\n- Implement in AOT compiler with LLVM math intrinsics","acceptance_criteria":"- All seven math built-ins work correctly\n- @floor, @ceil, @round return Int type\n- @abs, @sqrt, @min, @max work with Float type\n- Tests pass with various inputs including edge cases\n- LLVM correctly generates efficient math operations","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-09T18:08:30.439693-06:00","updated_at":"2025-11-10T08:21:15.872971-06:00","closed_at":"2025-11-10T08:21:15.872971-06:00","dependencies":[{"issue_id":"tea-87","depends_on_id":"tea-67","type":"blocks","created_at":"2025-11-09T18:09:16.834344-06:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tea-88","title":"Built-ins: Rename existing built-ins (print→@print, length→@len, min→@min, max→@max)","description":"Rename existing built-in functions to use @ prefix and new names per spec","design":"- print() -\u003e @print()\n- length() -\u003e @len()\n- min() -\u003e @min() (will be replaced by Float version in tea-70)\n- max() -\u003e @max() (will be replaced by Float version in tea-70)\n- Update builtins.rs registration\n- Update AOT compiler call sites\n- Note: min/max currently work with Any type, will need updating for Float-only in tea-70","acceptance_criteria":"- @print() works (old print() removed)\n- @len() works (old length() removed)\n- @min() and @max() work with @ prefix\n- No references to old names remain in compiler\n- Tests updated and passing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:08:35.722672-06:00","updated_at":"2025-11-10T08:21:15.783351-06:00","closed_at":"2025-11-10T08:21:15.783351-06:00","dependencies":[{"issue_id":"tea-88","depends_on_id":"tea-67","type":"blocks","created_at":"2025-11-09T18:09:17.529645-06:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tea-89","title":"Built-ins: Remove deprecated built-ins (exit, delete, clear, append)","description":"Remove four built-in functions that are not in the new stdlib spec","design":"- Remove exit() from builtins\n- Remove delete() from builtins (Dict operation)\n- Remove clear() from builtins (Dict operation)\n- Remove append() from builtins (List operation)\n- Remove from BUILTINS array\n- Remove from StdFunctionKind enum\n- Remove AOT compiler implementations\n- Remove any tests that depend on these functions","acceptance_criteria":"- exit(), delete(), clear(), append() no longer available\n- Compiler errors when trying to use these functions\n- All removed from builtins.rs\n- Tests pass (deprecated function tests removed)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:08:39.887143-06:00","updated_at":"2025-11-10T08:21:16.427916-06:00","closed_at":"2025-11-10T08:21:16.427916-06:00","dependencies":[{"issue_id":"tea-89","depends_on_id":"tea-67","type":"blocks","created_at":"2025-11-09T18:09:18.230816-06:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tea-9","title":"Stand up first-class Tea language server","notes":"Deliver a robust Tea language server that offers diagnostics, editing assists, and workspace awareness for editors like Neovim and VS Code. Track enhancements across parsing, type analysis, and tooling integration so the LSP becomes a reliable daily driver.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-10-24T01:11:42.214913-05:00","updated_at":"2025-10-24T16:49:14.470904-05:00","closed_at":"2025-10-24T16:49:14.470904-05:00"}
{"id":"tea-90","title":"Stdlib: Update assert module (rename assert→ok, remove fail, remove empty)","description":"Update assert module to match new spec: rename assert() to ok(), remove fail() and empty()","design":"- Rename assert(condition, message) -\u003e ok(value) with single param (truthy check)\n- Remove fail() function (replaced by @panic)\n- Remove empty() function (not in spec)\n- Remove all tea_* C symbol exports (tea_assert, tea_fail, etc.)\n- Keep eq(), ne(), snapshot()\n- Update function to use @panic instead of __intrinsic_fail","acceptance_criteria":"- assert.ok(value) works for truthy assertions\n- assert.eq() and assert.ne() still work\n- assert.snapshot() still works\n- fail() and empty() no longer available\n- C symbol exports removed\n- Tests updated and passing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:08:45.492204-06:00","updated_at":"2025-11-10T08:21:16.316011-06:00","closed_at":"2025-11-10T08:21:16.316011-06:00","dependencies":[{"issue_id":"tea-90","depends_on_id":"tea-86","type":"blocks","created_at":"2025-11-09T18:09:18.942696-06:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tea-91","title":"Stdlib: Update string module (add replace, to_lower, to_upper)","description":"Add three new string manipulation functions to string module","design":"Add to stdlib/string/mod.tea:\n- replace(text: String, pattern: String, replacement: String) -\u003e String (use existing string_replace intrinsic)\n- to_lower(text: String) -\u003e String (need new intrinsic)\n- to_upper(text: String) -\u003e String (need new intrinsic)\n\nKeep all existing functions:\n- starts_with(), ends_with(), trim_start(), trim_end(), trim(), reverse()\n\nAdd intrinsics for to_lower/to_upper if not present","acceptance_criteria":"- string.replace() works using intrinsic\n- string.to_lower() converts to lowercase\n- string.to_upper() converts to uppercase\n- All existing string functions still work\n- Tests pass","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-09T18:08:50.380969-06:00","updated_at":"2025-11-10T08:21:16.142137-06:00","closed_at":"2025-11-10T08:21:16.142137-06:00","dependencies":[{"issue_id":"tea-91","depends_on_id":"tea-80","type":"blocks","created_at":"2025-11-09T18:09:19.650207-06:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tea-92","title":"Stdlib: Remove math module entirely","description":"Remove the entire math standard library module (functions moved to built-ins)","design":"- Delete stdlib/math/mod.tea\n- Remove math module from MODULES array in stdlib/mod.rs\n- Remove any math module references from documentation\n- Functions like abs(), min(), max() now available as @abs(), @min(), @max()\n- Functions like sign(), pow() removed entirely (not in spec)","acceptance_criteria":"- stdlib/math/ directory removed\n- Cannot import \"std.math\"\n- Compiler error when trying to use math module\n- Tests updated to use built-in math functions instead\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:08:55.068083-06:00","updated_at":"2025-11-10T08:21:15.746761-06:00","closed_at":"2025-11-10T08:21:15.746761-06:00","dependencies":[{"issue_id":"tea-92","depends_on_id":"tea-87","type":"blocks","created_at":"2025-11-09T18:09:20.39489-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-92","depends_on_id":"tea-88","type":"blocks","created_at":"2025-11-09T18:09:21.057205-06:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tea-93","title":"Stdlib: Remove yaml module entirely","description":"Remove the entire yaml standard library module (not in new spec)","design":"- Delete stdlib/yaml/mod.tea\n- Remove yaml module from MODULES array in stdlib/mod.rs\n- Remove yaml intrinsics (yaml_encode, yaml_decode)\n- Remove from StdFunctionKind enum\n- Remove yaml support from AOT compiler\n- Remove any yaml dependencies from Cargo.toml if present","acceptance_criteria":"- stdlib/yaml/ directory removed\n- Cannot import \"std.yaml\"\n- Compiler error when trying to use yaml module\n- yaml intrinsics removed\n- Tests pass (yaml tests removed)\n- No yaml dependencies in project","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T18:08:57.947865-06:00","updated_at":"2025-11-10T08:21:16.158776-06:00","closed_at":"2025-11-10T08:21:16.158776-06:00","dependencies":[{"issue_id":"tea-93","depends_on_id":"tea-81","type":"blocks","created_at":"2025-11-09T18:09:21.760932-06:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tea-94","title":"Docs: Update all documentation for new stdlib structure","description":"Update all documentation files to reflect new stdlib structure and @ prefix for built-ins","design":"Update documentation:\n- Move docs/new-stdlib.md content to docs/stdlib-reference.md\n- Update docs/intrinsics-reference.md with new intrinsics\n- Update stdlib/README.md to reflect new structure\n- Update main README.md if it mentions stdlib\n- Update AGENTS.md if needed\n- Remove references to removed modules (math, yaml)\n- Document @ prefix for built-ins\n- Update function signatures and examples","acceptance_criteria":"- All docs reflect new stdlib structure\n- @ prefix documented for built-ins\n- No references to removed modules/functions\n- Examples use correct new syntax\n- docs/stdlib-reference.md is authoritative source","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-09T18:09:02.715909-06:00","updated_at":"2025-11-10T08:21:16.543669-06:00","closed_at":"2025-11-10T08:21:16.543669-06:00","dependencies":[{"issue_id":"tea-94","depends_on_id":"tea-67","type":"blocks","created_at":"2025-11-09T18:09:22.42857-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-94","depends_on_id":"tea-85","type":"blocks","created_at":"2025-11-09T18:09:23.178528-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-94","depends_on_id":"tea-86","type":"blocks","created_at":"2025-11-09T18:09:24.010108-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-94","depends_on_id":"tea-87","type":"blocks","created_at":"2025-11-09T18:09:24.583175-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-94","depends_on_id":"tea-88","type":"blocks","created_at":"2025-11-09T18:09:25.282002-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-94","depends_on_id":"tea-89","type":"blocks","created_at":"2025-11-09T18:09:25.983847-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-94","depends_on_id":"tea-90","type":"blocks","created_at":"2025-11-09T18:09:26.694927-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-94","depends_on_id":"tea-74","type":"blocks","created_at":"2025-11-09T18:09:27.399755-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-94","depends_on_id":"tea-75","type":"blocks","created_at":"2025-11-09T18:09:28.102095-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-94","depends_on_id":"tea-76","type":"blocks","created_at":"2025-11-09T18:09:28.819991-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-94","depends_on_id":"tea-91","type":"blocks","created_at":"2025-11-09T18:09:29.539255-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-94","depends_on_id":"tea-92","type":"blocks","created_at":"2025-11-09T18:09:30.243337-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-94","depends_on_id":"tea-93","type":"blocks","created_at":"2025-11-09T18:09:30.941569-06:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tea-95","title":"Examples: Update all examples to use @ prefix for built-ins","description":"Update all .tea example files to use new @ prefix for built-ins and new stdlib structure","design":"Update all files in examples/:\n- Replace print() with @print()\n- Replace length() with @len()\n- Replace __intrinsic_fail() with @panic()\n- Update math module usage to use built-ins\n- Remove yaml module usage\n- Update fs/path/string module usage with new names\n- Update assert module usage (assert -\u003e ok)\n- Ensure all examples compile and run correctly","acceptance_criteria":"- All examples use @ prefix for built-ins\n- No examples use removed functions/modules\n- All examples use new stdlib function names\n- All examples compile without errors\n- All examples run correctly","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-09T18:09:07.008271-06:00","updated_at":"2025-11-10T08:21:16.408369-06:00","closed_at":"2025-11-10T08:21:16.408369-06:00","dependencies":[{"issue_id":"tea-95","depends_on_id":"tea-67","type":"blocks","created_at":"2025-11-09T18:09:31.630923-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-95","depends_on_id":"tea-85","type":"blocks","created_at":"2025-11-09T18:09:32.352884-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-95","depends_on_id":"tea-86","type":"blocks","created_at":"2025-11-09T18:09:33.044581-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-95","depends_on_id":"tea-87","type":"blocks","created_at":"2025-11-09T18:09:33.761003-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-95","depends_on_id":"tea-88","type":"blocks","created_at":"2025-11-09T18:09:34.450934-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-95","depends_on_id":"tea-89","type":"blocks","created_at":"2025-11-09T18:09:35.160456-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-95","depends_on_id":"tea-90","type":"blocks","created_at":"2025-11-09T18:09:35.884403-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-95","depends_on_id":"tea-74","type":"blocks","created_at":"2025-11-09T18:09:36.616114-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-95","depends_on_id":"tea-75","type":"blocks","created_at":"2025-11-09T18:09:37.280847-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-95","depends_on_id":"tea-76","type":"blocks","created_at":"2025-11-09T18:09:37.992739-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-95","depends_on_id":"tea-91","type":"blocks","created_at":"2025-11-09T18:09:38.724293-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-95","depends_on_id":"tea-92","type":"blocks","created_at":"2025-11-09T18:09:39.400144-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-95","depends_on_id":"tea-93","type":"blocks","created_at":"2025-11-09T18:09:40.418133-06:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tea-96","title":"Tests: Update all tests for new stdlib and built-ins","description":"Update all test files to use @ prefix for built-ins and new stdlib structure","design":"Update tests in:\n- tea-compiler/tests/*.rs: Update Rust integration tests\n- tests/*.tea: Update Tea test files\n- examples/ test files\n\nChanges:\n- Use @ prefix for all built-ins\n- Update stdlib imports and function names\n- Remove tests for deleted functions/modules\n- Add tests for new built-ins and stdlib functions\n- Ensure all tests pass","acceptance_criteria":"- All tests use @ prefix for built-ins\n- Tests use new stdlib function names\n- No tests reference removed functions/modules\n- New built-ins have test coverage\n- cargo test --workspace passes\n- scripts/e2e.sh passes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-09T18:09:11.600373-06:00","updated_at":"2025-11-10T08:21:16.281672-06:00","closed_at":"2025-11-10T08:21:16.281672-06:00","dependencies":[{"issue_id":"tea-96","depends_on_id":"tea-67","type":"blocks","created_at":"2025-11-09T18:09:40.807523-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-96","depends_on_id":"tea-85","type":"blocks","created_at":"2025-11-09T18:09:41.514885-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-96","depends_on_id":"tea-86","type":"blocks","created_at":"2025-11-09T18:09:42.230361-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-96","depends_on_id":"tea-87","type":"blocks","created_at":"2025-11-09T18:09:42.924056-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-96","depends_on_id":"tea-88","type":"blocks","created_at":"2025-11-09T18:09:43.631843-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-96","depends_on_id":"tea-89","type":"blocks","created_at":"2025-11-09T18:09:44.349557-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-96","depends_on_id":"tea-90","type":"blocks","created_at":"2025-11-09T18:09:44.577882-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-96","depends_on_id":"tea-74","type":"blocks","created_at":"2025-11-09T18:09:44.590849-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-96","depends_on_id":"tea-75","type":"blocks","created_at":"2025-11-09T18:09:44.606442-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-96","depends_on_id":"tea-76","type":"blocks","created_at":"2025-11-09T18:09:44.631082-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-96","depends_on_id":"tea-91","type":"blocks","created_at":"2025-11-09T18:09:44.66642-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-96","depends_on_id":"tea-92","type":"blocks","created_at":"2025-11-09T18:09:44.687658-06:00","created_by":"daemon","metadata":"{}"},{"issue_id":"tea-96","depends_on_id":"tea-93","type":"blocks","created_at":"2025-11-09T18:09:44.705104-06:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tea-dwh","title":"Create LLVM abstraction layer for AOT codegen","description":"The AOT code generator uses low-level LLVM APIs directly throughout. A thin abstraction layer would make the code more readable and reduce duplication.","design":"Create helper abstractions for common LLVM patterns:\n\n1. `LLVMBuilder` wrapper with typed helpers for common operations\n2. Function attribute helpers (nounwind, willreturn, etc.)\n3. Type construction helpers (i64, ptr, struct types)\n4. String constant helpers\n5. Control flow helpers (if/else blocks, loops)\n\nThis depends on breaking up aot/mod.rs first to have a clear place for these abstractions.","acceptance_criteria":"- [ ] Common LLVM patterns wrapped in helper functions\n- [ ] Reduced code duplication in AOT module\n- [ ] Type-safer LLVM value handling\n- [ ] All tests pass","status":"open","priority":2,"issue_type":"chore","created_at":"2025-12-07T07:24:53.649484-06:00","updated_at":"2025-12-07T07:24:53.649484-06:00","dependencies":[{"issue_id":"tea-dwh","depends_on_id":"tea-gcf","type":"blocks","created_at":"2025-12-07T07:25:11.332099-06:00","created_by":"bentruyman","metadata":"{}"}]}
{"id":"tea-gcf","title":"Break up aot/mod.rs into smaller modules","description":"The AOT code generation module is ~12,500 lines in a single file, making it difficult to maintain and navigate. Split it into logical submodules.","design":"Split `tea-compiler/src/aot/mod.rs` into focused submodules:\n\n1. `types.rs` - TeaValue type handling, type conversions, struct layouts\n2. `expressions.rs` - Expression compilation (binary ops, calls, indexing, etc.)\n3. `statements.rs` - Statement compilation (let, if, loop, return, etc.)\n4. `functions.rs` - Function compilation, closures, lambdas\n5. `builtins.rs` - Built-in function code generation\n6. `errors.rs` - Error handling and propagation logic\n7. `utils.rs` - Helper functions, LLVM wrappers\n\nKeep `mod.rs` as the entry point with the main `Compiler` struct and orchestration.","acceptance_criteria":"- [x] aot/mod.rs reduced (types.rs extracted, ~315 lines)\n- [ ] aot/mod.rs reduced to \u003c6000 lines (revised target)\n- [x] Each submodule has a clear single responsibility\n- [x] All existing tests pass\n- [ ] No public API changes to the compiler crate","notes":"Session 2 progress:\n\n- Added FFI macros to reduce boilerplate:\n  - `define_ffi_print_fn!` for print/println (18 methods → 18 one-liners)\n  - `define_ffi_typecheck_fn!` for util_is_* (8 methods)\n  - `define_ffi_string_getter_fn!` for env directory getters (5 methods)\n  - `define_ffi_string_transform_fn!` for string→string ops (7 methods)\n  - `define_ffi_string_predicate_fn!` for string→bool ops (5 methods)\n  - `define_ffi_string_to_list_fn!` for string→list ops (5 methods)\n  - `define_ffi_string_to_int_fn!` for string→int ops (3 methods)\n  - `define_ffi_list_to_string_fn!` for list→string ops (1 method)\n  - `define_ffi_string2_fn!` for (string,string)→string ops (3 methods)\n  - `define_ffi_string_setter_fn!` for string→void ops (4 methods)\n\nLine count reduction:\n- Session 1: 12,500 → 12,192 (~308 lines via types.rs extraction)\n- Session 2: 12,192 → 11,663 (~529 lines via macros)\n- Total: ~837 lines removed (6.7% reduction)\n\nAll 141 tests pass.","status":"in_progress","priority":1,"issue_type":"chore","assignee":"claude","created_at":"2025-12-07T07:24:48.093908-06:00","updated_at":"2025-12-07T20:38:23.857008-06:00"}
{"id":"tea-hnu","title":"Document platform-specific assumptions in runtime","description":"The runtime has platform-specific code (ARM64 ABI, SSO struct packing, Unix vs Windows) that lacks documentation explaining the assumptions and constraints.","design":"Add documentation comments explaining:\n\n1. TeaValue struct layout and why it's packed this way\n2. Small String Optimization (SSO) - the 22-byte threshold, alignment requirements\n3. Small List Optimization - the 8-element threshold\n4. ARM64 vs x86_64 ABI differences for struct passing\n5. Thread-local error state design and safety requirements\n6. Platform-specific conditionals (Unix permissions, Windows paths)\n\nUse `//!` module docs and `///` on key structs/functions.","acceptance_criteria":"- [ ] TeaValue struct documented with layout explanation\n- [ ] SSO and SLO thresholds explained\n- [ ] ABI differences documented\n- [ ] Safety requirements for unsafe blocks documented","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-07T07:24:54.278231-06:00","updated_at":"2025-12-07T07:24:54.278231-06:00"}
{"id":"tea-xp6","title":"Add property-based tests for type checker unification","description":"The type checker's unification logic handles complex interactions between generics, unions, and optionals. Property-based tests would help catch edge cases that unit tests miss.","design":"Add proptest or quickcheck tests targeting:\n\n1. `unify_types` - arbitrary type pairs should unify symmetrically\n2. `union_contains_type` - subset relationships should be transitive\n3. `substitute_type` - substitution should be idempotent when applied twice\n4. Generic instantiation - monomorphization should preserve type relationships\n\nCreate generators for the `Type` enum to produce arbitrary valid types.","acceptance_criteria":"- [ ] Property tests added using proptest\n- [ ] Covers unify_types, union_contains_type, substitute_type\n- [ ] Type generators produce valid nested types\n- [ ] Tests run in reasonable time (\u003c30s)","status":"closed","priority":2,"issue_type":"chore","assignee":"claude","created_at":"2025-12-07T07:24:52.968436-06:00","updated_at":"2025-12-07T08:34:58.055095-06:00","closed_at":"2025-12-07T08:34:58.055095-06:00"}
