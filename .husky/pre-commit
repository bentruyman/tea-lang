if ! command -v bd >/dev/null 2>&1; then
  echo "Warning: bd command not found, skipping pre-commit flush" >&2
  exit 0
fi

if ! bd sync --flush-only >/dev/null 2>&1; then
  echo "Error: Failed to flush bd changes to JSONL" >&2
  echo "Run 'bd sync --flush-only' manually to diagnose" >&2
  exit 1
fi

git add .beads/issues.jsonl 2>/dev/null || true

cargo fmt --all
npx lint-staged
