# Comprehensive test of Tea-native stdlib modules
# Tests all migrated modules: env, fs, path, cli

use env = "std.env"
use fs = "std.fs"
use path = "std.path"
use cli = "std.cli"

pub def test_env() -> Void
  print("=== Testing std.env ===")

  # Test get
  print(env.home_dir())

  # Test cwd
  print(env.cwd())

  # Test has
  if env.has("PATH")
    print("✓ PATH variable exists")
  end

  # Test set/get/unset
  env.set("TEA_TEST_VAR", "test_value")

  if env.has("TEA_TEST_VAR")
    print("✓ env.set works")
  end

  env.unset("TEA_TEST_VAR")

  if ! env.has("TEA_TEST_VAR")
    print("✓ env.unset works")
  end

  # Test temp_dir and config_dir
  print(env.temp_dir())
  print(env.config_dir())
end

pub def test_path() -> Void
  print("=== Testing std.path ===")

  # Test join
  print(path.join(["usr", "local", "bin"]))

  # Test basename and dirname
  var file_path = "/usr/local/bin/tea"
  print(path.basename(file_path))
  print(path.dirname(file_path))

  # Test extension
  print(path.extension("script.tea"))

  # Test strip_extension
  print(path.strip_extension("script.tea"))

  # Test separator
  print(path.separator())

  # Test is_absolute
  if path.is_absolute("/usr/local")
    print("✓ is_absolute works")
  end
end

pub def test_fs() -> Void
  print("=== Testing std.fs ===")

  # Test exists and is_dir on current directory
  var cwd = env.cwd()

  if fs.exists(cwd)
    print("✓ fs.exists works")
  end

  if fs.is_dir(cwd)
    print("✓ fs.is_dir works")
  end

  # Test ensure_dir and ensure_parent
  var test_dir = "/tmp/tea_test_dir/nested"
  fs.ensure_dir(test_dir)

  if fs.exists(test_dir)
    print("✓ fs.ensure_dir works")
    fs.remove(test_dir)
    fs.remove("/tmp/tea_test_dir")
  end

  # Test write and read
  var test_file = "/tmp/tea_test_file.txt"
  fs.write_text(test_file, "Hello from Tea!")
  var content = fs.read_text(test_file)

  if content == "Hello from Tea!"
    print("✓ fs.write_text and fs.read_text work")
  end

  # Test size (checking that file exists and has content)
  if fs.size(test_file) > 0
    print("✓ fs.size works")
  end

  # Clean up
  fs.remove(test_file)

  if ! fs.exists(test_file)
    print("✓ fs.remove works")
  end
end

pub def test_cli() -> Void
  print("=== Testing std.cli ===")

  var args = cli.args()
  print("Program arguments:")
  print(args)
end

# Run all tests
test_env()
test_path()
test_fs()
test_cli()

print("=== All Stdlib Tests Complete ===")
