# Testing

Learn how to write and run tests for Tea programs and contribute tests to the Tea compiler.

## Testing Tea Programs

Use the `std.assert` module to write tests for your Tea code.

<Card className="p-6 bg-card border-border mb-4">

### Basic Assertions

```tea
use assert = "std.assert"

# Assert a condition is true
assert.ok(1 + 1 == 2)
assert.ok(true)

# Assert two values are equal
assert.eq(1 + 1, 2)
assert.eq("hello", "hello")

# Assert two values are not equal
assert.ne(1, 2)
assert.ne("hello", "world")
```

</Card>

<Card className="p-6 bg-card border-border mb-4">

### Testing Functions

```tea
use assert = "std.assert"

def add(a: Int, b: Int) -> Int
  a + b
end

def factorial(n: Int) -> Int
  if n <= 1
    return 1
  end
  n * factorial(n - 1)
end

# Test the functions
assert.eq(add(2, 3), 5)
assert.eq(add(0, 0), 0)
assert.eq(add(-1, 1), 0)

assert.eq(factorial(0), 1)
assert.eq(factorial(1), 1)
assert.eq(factorial(5), 120)
```

</Card>

<Card className="p-6 bg-card border-border">

### Testing Structs

```tea
use assert = "std.assert"

struct Point {
  x: Int
  y: Int
}

def distance_from_origin(p: Point) -> Int
  p.x * p.x + p.y * p.y
end

var origin = Point(x: 0, y: 0)
var point = Point(x: 3, y: 4)

assert.eq(distance_from_origin(origin), 0)
assert.eq(distance_from_origin(point), 25)
```

</Card>

## Running Tests

<Card className="p-6 bg-card border-border">

### Running a Test File

```bash
# Run a test file
tea tests/my_test.tea

# If all assertions pass, the program exits successfully
# If any assertion fails, the program panics with an error
```

</Card>

## Compiler Tests

If you're contributing to the Tea compiler, here's how to run and write tests.

<Card className="p-6 bg-card border-border mb-4">

### Running All Tests

```bash
# Run all tests (Rust tests + E2E tests)
make test

# Run Rust tests only
cargo test --workspace

# Run E2E tests only
./scripts/e2e.sh
```

</Card>

<Card className="p-6 bg-card border-border mb-4">

### Running Specific Tests

```bash
# Run a specific test by name
cargo test -p tea-compiler test_name

# Examples:
cargo test -p tea-compiler interpolated_strings
cargo test -p tea-compiler generics
cargo test -p tea-compiler error_handling
```

</Card>

<Card className="p-6 bg-card border-border">

### Test Organization

Compiler tests are organized by feature in `tea-compiler/tests/`.

```
tea-compiler/tests/
├── aot_examples.rs     # AOT compilation tests
├── generics.rs         # Generic type tests
├── error_handling.rs   # Error handling tests
├── strings.rs          # String operation tests
└── ...
```

</Card>

## Writing Compiler Tests

<Card className="p-6 bg-card border-border mb-4">

### Integration Test Structure

```rust
// tea-compiler/tests/my_feature.rs

#[test]
fn test_feature_works() {
    let source = r#"
        def add(a: Int, b: Int) -> Int
          a + b
        end

        @println(add(1, 2))
    "#;

    // Compile and run the source
    let result = compile_and_run(source);
    assert!(result.is_ok());
    assert_eq!(result.unwrap().stdout, "3\n");
}
```

</Card>

<Card className="p-6 bg-card border-border">

### Example Tests

Add example programs to `examples/` that are automatically tested.

```tea
# examples/language/my_feature/test.tea
# Expect: expected output

use assert = "std.assert"

# Your test code here
var result = my_function()
assert.eq(result, expected_value)

@println("expected output")
```

</Card>

## Best Practices

<Card className="p-6 bg-card border-border">
  <ul className="space-y-3 text-sm">
    <li className="flex items-start gap-3">
      <span className="text-accent">•</span>
      <span className="text-muted-foreground">
        Write tests for each new feature or bug fix
      </span>
    </li>
    <li className="flex items-start gap-3">
      <span className="text-accent">•</span>
      <span className="text-muted-foreground">
        Test edge cases and error conditions
      </span>
    </li>
    <li className="flex items-start gap-3">
      <span className="text-accent">•</span>
      <span className="text-muted-foreground">
        Keep tests focused and independent
      </span>
    </li>
    <li className="flex items-start gap-3">
      <span className="text-accent">•</span>
      <span className="text-muted-foreground">
        Use descriptive test names that explain what's being tested
      </span>
    </li>
    <li className="flex items-start gap-3">
      <span className="text-accent">•</span>
      <span className="text-muted-foreground">
        Run `make test` before submitting PRs
      </span>
    </li>
  </ul>
</Card>

## Next Steps

<NextLink href="/docs/contributing" title="Contributing Guide" description="Submit your tests with a pull request" />
<NextLink href="/docs/code-style" title="Code Style" description="Format your test code correctly" />
